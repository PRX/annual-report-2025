import{r as t,g as i,h as e,H as s}from"./p-C0pqcqYG.js";function r(t){let i=t[0];let e=t[1];let s=t[2];return Math.sqrt(i*i+e*e+s*s)}function h(t,i){t[0]=i[0];t[1]=i[1];t[2]=i[2];return t}function n(t,i,e,s){t[0]=i;t[1]=e;t[2]=s;return t}function l(t,i,e){t[0]=i[0]+e[0];t[1]=i[1]+e[1];t[2]=i[2]+e[2];return t}function o(t,i,e){t[0]=i[0]-e[0];t[1]=i[1]-e[1];t[2]=i[2]-e[2];return t}function u(t,i,e){t[0]=i[0]*e[0];t[1]=i[1]*e[1];t[2]=i[2]*e[2];return t}function a(t,i,e){t[0]=i[0]/e[0];t[1]=i[1]/e[1];t[2]=i[2]/e[2];return t}function f(t,i,e){t[0]=i[0]*e;t[1]=i[1]*e;t[2]=i[2]*e;return t}function c(t,i){let e=i[0]-t[0];let s=i[1]-t[1];let r=i[2]-t[2];return Math.sqrt(e*e+s*s+r*r)}function d(t,i){let e=i[0]-t[0];let s=i[1]-t[1];let r=i[2]-t[2];return e*e+s*s+r*r}function p(t){let i=t[0];let e=t[1];let s=t[2];return i*i+e*e+s*s}function m(t,i){t[0]=-i[0];t[1]=-i[1];t[2]=-i[2];return t}function x(t,i){t[0]=1/i[0];t[1]=1/i[1];t[2]=1/i[2];return t}function M(t,i){let e=i[0];let s=i[1];let r=i[2];let h=e*e+s*s+r*r;if(h>0){h=1/Math.sqrt(h)}t[0]=i[0]*h;t[1]=i[1]*h;t[2]=i[2]*h;return t}function g(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}function v(t,i,e){let s=i[0],r=i[1],h=i[2];let n=e[0],l=e[1],o=e[2];t[0]=r*o-h*l;t[1]=h*n-s*o;t[2]=s*l-r*n;return t}function y(t,i,e,s){let r=i[0];let h=i[1];let n=i[2];t[0]=r+s*(e[0]-r);t[1]=h+s*(e[1]-h);t[2]=n+s*(e[2]-n);return t}function w(t,i,e,s,r){const h=Math.exp(-s*r);let n=i[0];let l=i[1];let o=i[2];t[0]=e[0]+(n-e[0])*h;t[1]=e[1]+(l-e[1])*h;t[2]=e[2]+(o-e[2])*h;return t}function _(t,i,e){let s=i[0],r=i[1],h=i[2];let n=e[3]*s+e[7]*r+e[11]*h+e[15];n=n||1;t[0]=(e[0]*s+e[4]*r+e[8]*h+e[12])/n;t[1]=(e[1]*s+e[5]*r+e[9]*h+e[13])/n;t[2]=(e[2]*s+e[6]*r+e[10]*h+e[14])/n;return t}function A(t,i,e){let s=i[0],r=i[1],h=i[2];let n=e[3]*s+e[7]*r+e[11]*h+e[15];n=n||1;t[0]=(e[0]*s+e[4]*r+e[8]*h)/n;t[1]=(e[1]*s+e[5]*r+e[9]*h)/n;t[2]=(e[2]*s+e[6]*r+e[10]*h)/n;return t}function b(t,i,e){let s=i[0],r=i[1],h=i[2];t[0]=s*e[0]+r*e[3]+h*e[6];t[1]=s*e[1]+r*e[4]+h*e[7];t[2]=s*e[2]+r*e[5]+h*e[8];return t}function C(t,i,e){let s=i[0],r=i[1],h=i[2];let n=e[0],l=e[1],o=e[2],u=e[3];let a=l*h-o*r;let f=o*s-n*h;let c=n*r-l*s;let d=l*c-o*f;let p=o*a-n*c;let m=n*f-l*a;let x=u*2;a*=x;f*=x;c*=x;d*=2;p*=2;m*=2;t[0]=s+a+d;t[1]=r+f+p;t[2]=h+c+m;return t}const S=function(){const t=[0,0,0];const i=[0,0,0];return function(e,s){h(t,e);h(i,s);M(t,t);M(i,i);let r=g(t,i);if(r>1){return 0}else if(r<-1){return Math.PI}else{return Math.acos(r)}}}();function E(t,i){return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]}class B extends Array{constructor(t=0,i=t,e=t){super(t,i,e);return this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,i=t,e=t){if(t.length)return this.copy(t);n(this,t,i,e);return this}copy(t){h(this,t);return this}add(t,i){if(i)l(this,t,i);else l(this,this,t);return this}sub(t,i){if(i)o(this,t,i);else o(this,this,t);return this}multiply(t){if(t.length)u(this,this,t);else f(this,this,t);return this}divide(t){if(t.length)a(this,this,t);else f(this,this,1/t);return this}inverse(t=this){x(this,t);return this}len(){return r(this)}distance(t){if(t)return c(this,t);else return r(this)}squaredLen(){return p(this)}squaredDistance(t){if(t)return d(this,t);else return p(this)}negate(t=this){m(this,t);return this}cross(t,i){if(i)v(this,t,i);else v(this,this,t);return this}scale(t){f(this,this,t);return this}normalize(){M(this,this);return this}dot(t){return g(this,t)}equals(t){return E(this,t)}applyMatrix3(t){b(this,this,t);return this}applyMatrix4(t){_(this,this,t);return this}scaleRotateMatrix4(t){A(this,this,t);return this}applyQuaternion(t){C(this,this,t);return this}angle(t){return S(this,t)}lerp(t,i){y(this,this,t,i);return this}smoothLerp(t,i,e){w(this,this,t,i,e);return this}clone(){return new B(this[0],this[1],this[2])}fromArray(t,i=0){this[0]=t[i];this[1]=t[i+1];this[2]=t[i+2];return this}toArray(t=[],i=0){t[i]=this[0];t[i+1]=this[1];t[i+2]=this[2];return t}transformDirection(t){const i=this[0];const e=this[1];const s=this[2];this[0]=t[0]*i+t[4]*e+t[8]*s;this[1]=t[1]*i+t[5]*e+t[9]*s;this[2]=t[2]*i+t[6]*e+t[10]*s;return this.normalize()}}const F=new B;let O=1;let z=1;let L=false;class X{constructor(t,i={}){if(!t.canvas)console.error("gl not passed as first argument to Geometry");this.gl=t;this.attributes=i;this.id=O++;this.VAOs={};this.drawRange={start:0,count:0};this.instancedCount=0;this.gl.renderer.bindVertexArray(null);this.gl.renderer.currentGeometry=null;this.glState=this.gl.renderer.state;for(let t in i){this.addAttribute(t,i[t])}}addAttribute(t,i){this.attributes[t]=i;i.id=z++;i.size=i.size||1;i.type=i.type||(i.data.constructor===Float32Array?this.gl.FLOAT:i.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT);i.target=t==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER;i.normalized=i.normalized||false;i.stride=i.stride||0;i.offset=i.offset||0;i.count=i.count||(i.stride?i.data.byteLength/i.stride:i.data.length/i.size);i.divisor=i.instanced||0;i.needsUpdate=false;i.usage=i.usage||this.gl.STATIC_DRAW;if(!i.buffer){this.updateAttribute(i)}if(i.divisor){this.isInstanced=true;if(this.instancedCount&&this.instancedCount!==i.count*i.divisor){console.warn("geometry has multiple instanced buffers of different length");return this.instancedCount=Math.min(this.instancedCount,i.count*i.divisor)}this.instancedCount=i.count*i.divisor}else if(t==="index"){this.drawRange.count=i.count}else if(!this.attributes.index){this.drawRange.count=Math.max(this.drawRange.count,i.count)}}updateAttribute(t){const i=!t.buffer;if(i)t.buffer=this.gl.createBuffer();if(this.glState.boundBuffer!==t.buffer){this.gl.bindBuffer(t.target,t.buffer);this.glState.boundBuffer=t.buffer}if(i){this.gl.bufferData(t.target,t.data,t.usage)}else{this.gl.bufferSubData(t.target,0,t.data)}t.needsUpdate=false}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,i){this.drawRange.start=t;this.drawRange.count=i}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray();this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]);this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:i,type:e})=>{if(!this.attributes[i]){console.warn(`active attribute ${i} not being supplied`);return}const s=this.attributes[i];this.gl.bindBuffer(s.target,s.buffer);this.glState.boundBuffer=s.buffer;let r=1;if(e===35674)r=2;if(e===35675)r=3;if(e===35676)r=4;const h=s.size/r;const n=r===1?0:r*r*4;const l=r===1?0:r*4;for(let i=0;i<r;i++){this.gl.vertexAttribPointer(t+i,h,s.type,s.normalized,s.stride+n,s.offset+i*l);this.gl.enableVertexAttribArray(t+i);this.gl.renderer.vertexAttribDivisor(t+i,s.divisor)}}));if(this.attributes.index)this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:i=this.gl.TRIANGLES}){if(this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`){if(!this.VAOs[t.attributeOrder])this.createVAO(t);this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]);this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`}t.attributeLocations.forEach(((t,{name:i})=>{const e=this.attributes[i];if(e.needsUpdate)this.updateAttribute(e)}));let e=2;if(this.attributes.index?.type===this.gl.UNSIGNED_INT)e=4;if(this.isInstanced){if(this.attributes.index){this.gl.renderer.drawElementsInstanced(i,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*e,this.instancedCount)}else{this.gl.renderer.drawArraysInstanced(i,this.drawRange.start,this.drawRange.count,this.instancedCount)}}else{if(this.attributes.index){this.gl.drawElements(i,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*e)}else{this.gl.drawArrays(i,this.drawRange.start,this.drawRange.count)}}}getPosition(){const t=this.attributes.position;if(t.data)return t;if(L)return;console.warn("No position buffer data found to compute bounds");return L=true}computeBoundingBox(t){if(!t)t=this.getPosition();const i=t.data;const e=t.size;if(!this.bounds){this.bounds={min:new B,max:new B,center:new B,scale:new B,radius:Infinity}}const s=this.bounds.min;const r=this.bounds.max;const h=this.bounds.center;const n=this.bounds.scale;s.set(+Infinity);r.set(-Infinity);for(let t=0,h=i.length;t<h;t+=e){const e=i[t];const h=i[t+1];const n=i[t+2];s.x=Math.min(e,s.x);s.y=Math.min(h,s.y);s.z=Math.min(n,s.z);r.x=Math.max(e,r.x);r.y=Math.max(h,r.y);r.z=Math.max(n,r.z)}n.sub(r,s);h.add(s,r).divide(2)}computeBoundingSphere(t){if(!t)t=this.getPosition();const i=t.data;const e=t.size;if(!this.bounds)this.computeBoundingBox(t);let s=0;for(let t=0,r=i.length;t<r;t+=e){F.fromArray(i,t);s=Math.max(s,this.bounds.center.squaredDistance(F))}this.bounds.radius=Math.sqrt(s)}remove(){for(let t in this.VAOs){this.gl.renderer.deleteVertexArray(this.VAOs[t]);delete this.VAOs[t]}for(let t in this.attributes){this.gl.deleteBuffer(this.attributes[t].buffer);delete this.attributes[t]}}}let G=1;const I={};class R{constructor(t,{vertex:i,fragment:e,uniforms:s={},transparent:r=false,cullFace:h=t.BACK,frontFace:n=t.CCW,depthTest:l=true,depthWrite:o=true,depthFunc:u=t.LEQUAL}={}){if(!t.canvas)console.error("gl not passed as first argument to Program");this.gl=t;this.uniforms=s;this.id=G++;if(!i)console.warn("vertex shader not supplied");if(!e)console.warn("fragment shader not supplied");this.transparent=r;this.cullFace=h;this.frontFace=n;this.depthTest=l;this.depthWrite=o;this.depthFunc=u;this.blendFunc={};this.blendEquation={};this.stencilFunc={};this.stencilOp={};if(this.transparent&&!this.blendFunc.src){if(this.gl.renderer.premultipliedAlpha)this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);else this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}this.vertexShader=t.createShader(t.VERTEX_SHADER);this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);this.program=t.createProgram();t.attachShader(this.program,this.vertexShader);t.attachShader(this.program,this.fragmentShader);this.setShaders({vertex:i,fragment:e})}setShaders({vertex:t,fragment:i}){if(t){this.gl.shaderSource(this.vertexShader,t);this.gl.compileShader(this.vertexShader);if(this.gl.getShaderInfoLog(this.vertexShader)!==""){console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}\nVertex Shader\n${P(t)}`)}}if(i){this.gl.shaderSource(this.fragmentShader,i);this.gl.compileShader(this.fragmentShader);if(this.gl.getShaderInfoLog(this.fragmentShader)!==""){console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}\nFragment Shader\n${P(i)}`)}}this.gl.linkProgram(this.program);if(!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)){return console.warn(this.gl.getProgramInfoLog(this.program))}this.uniformLocations=new Map;let e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let t=0;t<e;t++){let i=this.gl.getActiveUniform(this.program,t);this.uniformLocations.set(i,this.gl.getUniformLocation(this.program,i.name));const e=i.name.match(/(\w+)/g);i.uniformName=e[0];i.nameComponents=e.slice(1)}this.attributeLocations=new Map;const s=[];const r=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let t=0;t<r;t++){const i=this.gl.getActiveAttrib(this.program,t);const e=this.gl.getAttribLocation(this.program,i.name);if(e===-1)continue;s[e]=i.name;this.attributeLocations.set(i,e)}this.attributeOrder=s.join("")}setBlendFunc(t,i,e,s){this.blendFunc.src=t;this.blendFunc.dst=i;this.blendFunc.srcAlpha=e;this.blendFunc.dstAlpha=s;if(t)this.transparent=true}setBlendEquation(t,i){this.blendEquation.modeRGB=t;this.blendEquation.modeAlpha=i}setStencilFunc(t,i,e){this.stencilRef=i;this.stencilFunc.func=t;this.stencilFunc.ref=i;this.stencilFunc.mask=e}setStencilOp(t,i,e){this.stencilOp.stencilFail=t;this.stencilOp.depthFail=i;this.stencilOp.depthPass=e}applyState(){if(this.depthTest)this.gl.renderer.enable(this.gl.DEPTH_TEST);else this.gl.renderer.disable(this.gl.DEPTH_TEST);if(this.cullFace)this.gl.renderer.enable(this.gl.CULL_FACE);else this.gl.renderer.disable(this.gl.CULL_FACE);if(this.blendFunc.src)this.gl.renderer.enable(this.gl.BLEND);else this.gl.renderer.disable(this.gl.BLEND);if(this.cullFace)this.gl.renderer.setCullFace(this.cullFace);this.gl.renderer.setFrontFace(this.frontFace);this.gl.renderer.setDepthMask(this.depthWrite);this.gl.renderer.setDepthFunc(this.depthFunc);if(this.blendFunc.src)this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha);this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha);if(this.stencilFunc.func||this.stencilOp.stencilFail)this.gl.renderer.enable(this.gl.STENCIL_TEST);else this.gl.renderer.disable(this.gl.STENCIL_TEST);this.gl.renderer.setStencilFunc(this.stencilFunc.func,this.stencilFunc.ref,this.stencilFunc.mask);this.gl.renderer.setStencilOp(this.stencilOp.stencilFail,this.stencilOp.depthFail,this.stencilOp.depthPass)}use({flipFaces:t=false}={}){let i=-1;const e=this.gl.renderer.state.currentProgram===this.id;if(!e){this.gl.useProgram(this.program);this.gl.renderer.state.currentProgram=this.id}this.uniformLocations.forEach(((t,e)=>{let s=this.uniforms[e.uniformName];for(const t of e.nameComponents){if(!s)break;if(t in s){s=s[t]}else if(Array.isArray(s.value)){break}else{s=undefined;break}}if(!s){return k(`Active uniform ${e.name} has not been supplied`)}if(s&&s.value===undefined){return k(`${e.name} uniform is missing a value parameter`)}if(s.value.texture){i=i+1;s.value.update(i);return Y(this.gl,e.type,t,i)}if(s.value.length&&s.value[0].texture){const r=[];s.value.forEach((t=>{i=i+1;t.update(i);r.push(i)}));return Y(this.gl,e.type,t,r)}Y(this.gl,e.type,t,s.value)}));this.applyState();if(t)this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function Y(t,i,e,s){s=s.length?Z(s):s;const r=t.renderer.state.uniformLocations.get(e);if(s.length){if(r===undefined||r.length!==s.length){t.renderer.state.uniformLocations.set(e,s.slice(0))}else{if(T(r,s))return;r.set?r.set(s):W(r,s);t.renderer.state.uniformLocations.set(e,r)}}else{if(r===s)return;t.renderer.state.uniformLocations.set(e,s)}switch(i){case 5126:return s.length?t.uniform1fv(e,s):t.uniform1f(e,s);case 35664:return t.uniform2fv(e,s);case 35665:return t.uniform3fv(e,s);case 35666:return t.uniform4fv(e,s);case 35670:case 5124:case 35678:case 36306:case 35680:case 36289:return s.length?t.uniform1iv(e,s):t.uniform1i(e,s);case 35671:case 35667:return t.uniform2iv(e,s);case 35672:case 35668:return t.uniform3iv(e,s);case 35673:case 35669:return t.uniform4iv(e,s);case 35674:return t.uniformMatrix2fv(e,false,s);case 35675:return t.uniformMatrix3fv(e,false,s);case 35676:return t.uniformMatrix4fv(e,false,s)}}function P(t){let i=t.split("\n");for(let t=0;t<i.length;t++){i[t]=t+1+": "+i[t]}return i.join("\n")}function Z(t){const i=t.length;const e=t[0].length;if(e===undefined)return t;const s=i*e;let r=I[s];if(!r)I[s]=r=new Float32Array(s);for(let s=0;s<i;s++)r.set(t[s],s*e);return r}function T(t,i){if(t.length!==i.length)return false;for(let e=0,s=t.length;e<s;e++){if(t[e]!==i[e])return false}return true}function W(t,i){for(let e=0,s=t.length;e<s;e++){t[e]=i[e]}}let $=0;function k(t){if($>100)return;console.warn(t);$++;if($>100)console.warn("More than 100 program warnings - stopping logs.")}const q=new B;let N=1;class V{constructor({canvas:t=document.createElement("canvas"),width:i=300,height:e=150,dpr:s=1,alpha:r=false,depth:h=true,stencil:n=false,antialias:l=false,premultipliedAlpha:o=false,preserveDrawingBuffer:u=false,powerPreference:a="default",autoClear:f=true,webgl:c=2}={}){const d={alpha:r,depth:h,stencil:n,antialias:l,premultipliedAlpha:o,preserveDrawingBuffer:u,powerPreference:a};this.dpr=s;this.alpha=r;this.color=true;this.depth=h;this.stencil=n;this.premultipliedAlpha=o;this.autoClear=f;this.id=N++;if(c===2)this.gl=t.getContext("webgl2",d);this.isWebgl2=!!this.gl;if(!this.gl)this.gl=t.getContext("webgl",d);if(!this.gl)console.error("unable to create webgl context");this.gl.renderer=this;this.setSize(i,e);this.state={};this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO};this.state.blendEquation={modeRGB:this.gl.FUNC_ADD};this.state.cullFace=false;this.state.frontFace=this.gl.CCW;this.state.depthMask=true;this.state.depthFunc=this.gl.LEQUAL;this.state.premultiplyAlpha=false;this.state.flipY=false;this.state.unpackAlignment=4;this.state.framebuffer=null;this.state.viewport={x:0,y:0,width:null,height:null};this.state.textureUnits=[];this.state.activeTextureUnit=0;this.state.boundBuffer=null;this.state.uniformLocations=new Map;this.state.currentProgram=null;this.extensions={};if(this.isWebgl2){this.getExtension("EXT_color_buffer_float");this.getExtension("OES_texture_float_linear")}else{this.getExtension("OES_texture_float");this.getExtension("OES_texture_float_linear");this.getExtension("OES_texture_half_float");this.getExtension("OES_texture_half_float_linear");this.getExtension("OES_element_index_uint");this.getExtension("OES_standard_derivatives");this.getExtension("EXT_sRGB");this.getExtension("WEBGL_depth_texture");this.getExtension("WEBGL_draw_buffers")}this.getExtension("WEBGL_compressed_texture_astc");this.getExtension("EXT_texture_compression_bptc");this.getExtension("WEBGL_compressed_texture_s3tc");this.getExtension("WEBGL_compressed_texture_etc1");this.getExtension("WEBGL_compressed_texture_pvrtc");this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE");this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE");this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE");this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES");this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES");this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES");this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL");this.parameters={};this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,i){this.width=t;this.height=i;this.gl.canvas.width=t*this.dpr;this.gl.canvas.height=i*this.dpr;if(!this.gl.canvas.style)return;Object.assign(this.gl.canvas.style,{width:t+"px",height:i+"px"})}setViewport(t,i,e=0,s=0){if(this.state.viewport.width===t&&this.state.viewport.height===i)return;this.state.viewport.width=t;this.state.viewport.height=i;this.state.viewport.x=e;this.state.viewport.y=s;this.gl.viewport(e,s,t,i)}setScissor(t,i,e=0,s=0){this.gl.scissor(e,s,t,i)}enable(t){if(this.state[t]===true)return;this.gl.enable(t);this.state[t]=true}disable(t){if(this.state[t]===false)return;this.gl.disable(t);this.state[t]=false}setBlendFunc(t,i,e,s){if(this.state.blendFunc.src===t&&this.state.blendFunc.dst===i&&this.state.blendFunc.srcAlpha===e&&this.state.blendFunc.dstAlpha===s)return;this.state.blendFunc.src=t;this.state.blendFunc.dst=i;this.state.blendFunc.srcAlpha=e;this.state.blendFunc.dstAlpha=s;if(e!==undefined)this.gl.blendFuncSeparate(t,i,e,s);else this.gl.blendFunc(t,i)}setBlendEquation(t,i){t=t||this.gl.FUNC_ADD;if(this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===i)return;this.state.blendEquation.modeRGB=t;this.state.blendEquation.modeAlpha=i;if(i!==undefined)this.gl.blendEquationSeparate(t,i);else this.gl.blendEquation(t)}setCullFace(t){if(this.state.cullFace===t)return;this.state.cullFace=t;this.gl.cullFace(t)}setFrontFace(t){if(this.state.frontFace===t)return;this.state.frontFace=t;this.gl.frontFace(t)}setDepthMask(t){if(this.state.depthMask===t)return;this.state.depthMask=t;this.gl.depthMask(t)}setDepthFunc(t){if(this.state.depthFunc===t)return;this.state.depthFunc=t;this.gl.depthFunc(t)}setStencilMask(t){if(this.state.stencilMask===t)return;this.state.stencilMask=t;this.gl.stencilMask(t)}setStencilFunc(t,i,e){if(this.state.stencilFunc===t&&this.state.stencilRef===i&&this.state.stencilFuncMask===e)return;this.state.stencilFunc=t||this.gl.ALWAYS;this.state.stencilRef=i||0;this.state.stencilFuncMask=e||0;this.gl.stencilFunc(t||this.gl.ALWAYS,i||0,e||0)}setStencilOp(t,i,e){if(this.state.stencilFail===t&&this.state.stencilDepthFail===i&&this.state.stencilDepthPass===e)return;this.state.stencilFail=t;this.state.stencilDepthFail=i;this.state.stencilDepthPass=e;this.gl.stencilOp(t,i,e)}activeTexture(t){if(this.state.activeTextureUnit===t)return;this.state.activeTextureUnit=t;this.gl.activeTexture(this.gl.TEXTURE0+t)}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:i=null}={}){if(this.state.framebuffer===i)return;this.state.framebuffer=i;this.gl.bindFramebuffer(t,i)}getExtension(t,i,e){if(i&&this.gl[i])return this.gl[i].bind(this.gl);if(!this.extensions[t]){this.extensions[t]=this.gl.getExtension(t)}if(!i)return this.extensions[t];if(!this.extensions[t])return null;return this.extensions[t][e].bind(this.extensions[t])}sortOpaque(t,i){if(t.renderOrder!==i.renderOrder){return t.renderOrder-i.renderOrder}else if(t.program.id!==i.program.id){return t.program.id-i.program.id}else if(t.zDepth!==i.zDepth){return t.zDepth-i.zDepth}else{return i.id-t.id}}sortTransparent(t,i){if(t.renderOrder!==i.renderOrder){return t.renderOrder-i.renderOrder}if(t.zDepth!==i.zDepth){return i.zDepth-t.zDepth}else{return i.id-t.id}}sortUI(t,i){if(t.renderOrder!==i.renderOrder){return t.renderOrder-i.renderOrder}else if(t.program.id!==i.program.id){return t.program.id-i.program.id}else{return i.id-t.id}}getRenderList({scene:t,camera:i,frustumCull:e,sort:s}){let r=[];if(i&&e)i.updateFrustum();t.traverse((t=>{if(!t.visible)return true;if(!t.draw)return;if(e&&t.frustumCulled&&i){if(!i.frustumIntersectsMesh(t))return}r.push(t)}));if(s){const t=[];const e=[];const s=[];r.forEach((r=>{if(!r.program.transparent){t.push(r)}else if(r.program.depthTest){e.push(r)}else{s.push(r)}r.zDepth=0;if(r.renderOrder!==0||!r.program.depthTest||!i)return;r.worldMatrix.getTranslation(q);q.applyMatrix4(i.projectionViewMatrix);r.zDepth=q.z}));t.sort(this.sortOpaque);e.sort(this.sortTransparent);s.sort(this.sortUI);r=t.concat(e,s)}return r}render({scene:t,camera:i,target:e=null,update:s=true,sort:r=true,frustumCull:h=true,clear:n}){if(e===null){this.bindFramebuffer();this.setViewport(this.width*this.dpr,this.height*this.dpr)}else{this.bindFramebuffer(e);this.setViewport(e.width,e.height)}if(n||this.autoClear&&n!==false){if(this.depth&&(!e||e.depth)){this.enable(this.gl.DEPTH_TEST);this.setDepthMask(true)}if(this.stencil||(!e||e.stencil)){this.enable(this.gl.STENCIL_TEST);this.setStencilMask(255)}this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))}if(s)t.updateMatrixWorld();if(i)i.updateMatrixWorld();const l=this.getRenderList({scene:t,camera:i,frustumCull:h,sort:r});l.forEach((t=>{t.draw({camera:i})}))}}function j(t,i){t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[3];return t}function D(t,i,e,s,r){t[0]=i;t[1]=e;t[2]=s;t[3]=r;return t}function Q(t,i){let e=i[0];let s=i[1];let r=i[2];let h=i[3];let n=e*e+s*s+r*r+h*h;if(n>0){n=1/Math.sqrt(n)}t[0]=e*n;t[1]=s*n;t[2]=r*n;t[3]=h*n;return t}function U(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]+t[3]*i[3]}function H(t){t[0]=0;t[1]=0;t[2]=0;t[3]=1;return t}function K(t,i,e){e=e*.5;let s=Math.sin(e);t[0]=s*i[0];t[1]=s*i[1];t[2]=s*i[2];t[3]=Math.cos(e);return t}function J(t,i,e){let s=i[0],r=i[1],h=i[2],n=i[3];let l=e[0],o=e[1],u=e[2],a=e[3];t[0]=s*a+n*l+r*u-h*o;t[1]=r*a+n*o+h*l-s*u;t[2]=h*a+n*u+s*o-r*l;t[3]=n*a-s*l-r*o-h*u;return t}function tt(t,i,e){e*=.5;let s=i[0],r=i[1],h=i[2],n=i[3];let l=Math.sin(e),o=Math.cos(e);t[0]=s*o+n*l;t[1]=r*o+h*l;t[2]=h*o-r*l;t[3]=n*o-s*l;return t}function it(t,i,e){e*=.5;let s=i[0],r=i[1],h=i[2],n=i[3];let l=Math.sin(e),o=Math.cos(e);t[0]=s*o-h*l;t[1]=r*o+n*l;t[2]=h*o+s*l;t[3]=n*o-r*l;return t}function et(t,i,e){e*=.5;let s=i[0],r=i[1],h=i[2],n=i[3];let l=Math.sin(e),o=Math.cos(e);t[0]=s*o+r*l;t[1]=r*o-s*l;t[2]=h*o+n*l;t[3]=n*o-h*l;return t}function st(t,i,e,s){let r=i[0],h=i[1],n=i[2],l=i[3];let o=e[0],u=e[1],a=e[2],f=e[3];let c,d,p,m,x;d=r*o+h*u+n*a+l*f;if(d<0){d=-d;o=-o;u=-u;a=-a;f=-f}if(1-d>1e-6){c=Math.acos(d);p=Math.sin(c);m=Math.sin((1-s)*c)/p;x=Math.sin(s*c)/p}else{m=1-s;x=s}t[0]=m*r+x*o;t[1]=m*h+x*u;t[2]=m*n+x*a;t[3]=m*l+x*f;return t}function rt(t,i){let e=i[0],s=i[1],r=i[2],h=i[3];let n=e*e+s*s+r*r+h*h;let l=n?1/n:0;t[0]=-e*l;t[1]=-s*l;t[2]=-r*l;t[3]=h*l;return t}function ht(t,i){t[0]=-i[0];t[1]=-i[1];t[2]=-i[2];t[3]=i[3];return t}function nt(t,i){let e=i[0]+i[4]+i[8];let s;if(e>0){s=Math.sqrt(e+1);t[3]=.5*s;s=.5/s;t[0]=(i[5]-i[7])*s;t[1]=(i[6]-i[2])*s;t[2]=(i[1]-i[3])*s}else{let e=0;if(i[4]>i[0])e=1;if(i[8]>i[e*3+e])e=2;let r=(e+1)%3;let h=(e+2)%3;s=Math.sqrt(i[e*3+e]-i[r*3+r]-i[h*3+h]+1);t[e]=.5*s;s=.5/s;t[3]=(i[r*3+h]-i[h*3+r])*s;t[r]=(i[r*3+e]+i[e*3+r])*s;t[h]=(i[h*3+e]+i[e*3+h])*s}return t}function lt(t,i,e="YXZ"){let s=Math.sin(i[0]*.5);let r=Math.cos(i[0]*.5);let h=Math.sin(i[1]*.5);let n=Math.cos(i[1]*.5);let l=Math.sin(i[2]*.5);let o=Math.cos(i[2]*.5);if(e==="XYZ"){t[0]=s*n*o+r*h*l;t[1]=r*h*o-s*n*l;t[2]=r*n*l+s*h*o;t[3]=r*n*o-s*h*l}else if(e==="YXZ"){t[0]=s*n*o+r*h*l;t[1]=r*h*o-s*n*l;t[2]=r*n*l-s*h*o;t[3]=r*n*o+s*h*l}else if(e==="ZXY"){t[0]=s*n*o-r*h*l;t[1]=r*h*o+s*n*l;t[2]=r*n*l+s*h*o;t[3]=r*n*o-s*h*l}else if(e==="ZYX"){t[0]=s*n*o-r*h*l;t[1]=r*h*o+s*n*l;t[2]=r*n*l-s*h*o;t[3]=r*n*o+s*h*l}else if(e==="YZX"){t[0]=s*n*o+r*h*l;t[1]=r*h*o+s*n*l;t[2]=r*n*l-s*h*o;t[3]=r*n*o-s*h*l}else if(e==="XZY"){t[0]=s*n*o-r*h*l;t[1]=r*h*o-s*n*l;t[2]=r*n*l+s*h*o;t[3]=r*n*o+s*h*l}return t}const ot=j;const ut=D;const at=U;const ft=Q;class ct extends Array{constructor(t=0,i=0,e=0,s=1){super(t,i,e,s);this.onChange=()=>{};this._target=this;const r=["0","1","2","3"];return new Proxy(this,{set(t,i){const e=Reflect.set(...arguments);if(e&&r.includes(i))t.onChange();return e}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this._target[0]=t;this.onChange()}set y(t){this._target[1]=t;this.onChange()}set z(t){this._target[2]=t;this.onChange()}set w(t){this._target[3]=t;this.onChange()}identity(){H(this._target);this.onChange();return this}set(t,i,e,s){if(t.length)return this.copy(t);ut(this._target,t,i,e,s);this.onChange();return this}rotateX(t){tt(this._target,this._target,t);this.onChange();return this}rotateY(t){it(this._target,this._target,t);this.onChange();return this}rotateZ(t){et(this._target,this._target,t);this.onChange();return this}inverse(t=this._target){rt(this._target,t);this.onChange();return this}conjugate(t=this._target){ht(this._target,t);this.onChange();return this}copy(t){ot(this._target,t);this.onChange();return this}normalize(t=this._target){ft(this._target,t);this.onChange();return this}multiply(t,i){if(i){J(this._target,t,i)}else{J(this._target,this._target,t)}this.onChange();return this}dot(t){return at(this._target,t)}fromMatrix3(t){nt(this._target,t);this.onChange();return this}fromEuler(t,i){lt(this._target,t,t.order);if(!i)this.onChange();return this}fromAxisAngle(t,i){K(this._target,t,i);this.onChange();return this}slerp(t,i){st(this._target,this._target,t,i);this.onChange();return this}fromArray(t,i=0){this._target[0]=t[i];this._target[1]=t[i+1];this._target[2]=t[i+2];this._target[3]=t[i+3];this.onChange();return this}toArray(t=[],i=0){t[i]=this[0];t[i+1]=this[1];t[i+2]=this[2];t[i+3]=this[3];return t}}const dt=1e-6;function pt(t,i){t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[3];t[4]=i[4];t[5]=i[5];t[6]=i[6];t[7]=i[7];t[8]=i[8];t[9]=i[9];t[10]=i[10];t[11]=i[11];t[12]=i[12];t[13]=i[13];t[14]=i[14];t[15]=i[15];return t}function mt(t,i,e,s,r,h,n,l,o,u,a,f,c,d,p,m,x){t[0]=i;t[1]=e;t[2]=s;t[3]=r;t[4]=h;t[5]=n;t[6]=l;t[7]=o;t[8]=u;t[9]=a;t[10]=f;t[11]=c;t[12]=d;t[13]=p;t[14]=m;t[15]=x;return t}function xt(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=1;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t}function Mt(t,i){let e=i[0],s=i[1],r=i[2],h=i[3];let n=i[4],l=i[5],o=i[6],u=i[7];let a=i[8],f=i[9],c=i[10],d=i[11];let p=i[12],m=i[13],x=i[14],M=i[15];let g=e*l-s*n;let v=e*o-r*n;let y=e*u-h*n;let w=s*o-r*l;let _=s*u-h*l;let A=r*u-h*o;let b=a*m-f*p;let C=a*x-c*p;let S=a*M-d*p;let E=f*x-c*m;let B=f*M-d*m;let F=c*M-d*x;let O=g*F-v*B+y*E+w*S-_*C+A*b;if(!O){return null}O=1/O;t[0]=(l*F-o*B+u*E)*O;t[1]=(r*B-s*F-h*E)*O;t[2]=(m*A-x*_+M*w)*O;t[3]=(c*_-f*A-d*w)*O;t[4]=(o*S-n*F-u*C)*O;t[5]=(e*F-r*S+h*C)*O;t[6]=(x*y-p*A-M*v)*O;t[7]=(a*A-c*y+d*v)*O;t[8]=(n*B-l*S+u*b)*O;t[9]=(s*S-e*B-h*b)*O;t[10]=(p*_-m*y+M*g)*O;t[11]=(f*y-a*_-d*g)*O;t[12]=(l*C-n*E-o*b)*O;t[13]=(e*E-s*C+r*b)*O;t[14]=(m*v-p*w-x*g)*O;t[15]=(a*w-f*v+c*g)*O;return t}function gt(t){let i=t[0],e=t[1],s=t[2],r=t[3];let h=t[4],n=t[5],l=t[6],o=t[7];let u=t[8],a=t[9],f=t[10],c=t[11];let d=t[12],p=t[13],m=t[14],x=t[15];let M=i*n-e*h;let g=i*l-s*h;let v=i*o-r*h;let y=e*l-s*n;let w=e*o-r*n;let _=s*o-r*l;let A=u*p-a*d;let b=u*m-f*d;let C=u*x-c*d;let S=a*m-f*p;let E=a*x-c*p;let B=f*x-c*m;return M*B-g*E+v*S+y*C-w*b+_*A}function vt(t,i,e){let s=i[0],r=i[1],h=i[2],n=i[3];let l=i[4],o=i[5],u=i[6],a=i[7];let f=i[8],c=i[9],d=i[10],p=i[11];let m=i[12],x=i[13],M=i[14],g=i[15];let v=e[0],y=e[1],w=e[2],_=e[3];t[0]=v*s+y*l+w*f+_*m;t[1]=v*r+y*o+w*c+_*x;t[2]=v*h+y*u+w*d+_*M;t[3]=v*n+y*a+w*p+_*g;v=e[4];y=e[5];w=e[6];_=e[7];t[4]=v*s+y*l+w*f+_*m;t[5]=v*r+y*o+w*c+_*x;t[6]=v*h+y*u+w*d+_*M;t[7]=v*n+y*a+w*p+_*g;v=e[8];y=e[9];w=e[10];_=e[11];t[8]=v*s+y*l+w*f+_*m;t[9]=v*r+y*o+w*c+_*x;t[10]=v*h+y*u+w*d+_*M;t[11]=v*n+y*a+w*p+_*g;v=e[12];y=e[13];w=e[14];_=e[15];t[12]=v*s+y*l+w*f+_*m;t[13]=v*r+y*o+w*c+_*x;t[14]=v*h+y*u+w*d+_*M;t[15]=v*n+y*a+w*p+_*g;return t}function yt(t,i,e){let s=e[0],r=e[1],h=e[2];let n,l,o,u;let a,f,c,d;let p,m,x,M;if(i===t){t[12]=i[0]*s+i[4]*r+i[8]*h+i[12];t[13]=i[1]*s+i[5]*r+i[9]*h+i[13];t[14]=i[2]*s+i[6]*r+i[10]*h+i[14];t[15]=i[3]*s+i[7]*r+i[11]*h+i[15]}else{n=i[0];l=i[1];o=i[2];u=i[3];a=i[4];f=i[5];c=i[6];d=i[7];p=i[8];m=i[9];x=i[10];M=i[11];t[0]=n;t[1]=l;t[2]=o;t[3]=u;t[4]=a;t[5]=f;t[6]=c;t[7]=d;t[8]=p;t[9]=m;t[10]=x;t[11]=M;t[12]=n*s+a*r+p*h+i[12];t[13]=l*s+f*r+m*h+i[13];t[14]=o*s+c*r+x*h+i[14];t[15]=u*s+d*r+M*h+i[15]}return t}function wt(t,i,e){let s=e[0],r=e[1],h=e[2];t[0]=i[0]*s;t[1]=i[1]*s;t[2]=i[2]*s;t[3]=i[3]*s;t[4]=i[4]*r;t[5]=i[5]*r;t[6]=i[6]*r;t[7]=i[7]*r;t[8]=i[8]*h;t[9]=i[9]*h;t[10]=i[10]*h;t[11]=i[11]*h;t[12]=i[12];t[13]=i[13];t[14]=i[14];t[15]=i[15];return t}function _t(t,i,e,s){let r=s[0],h=s[1],n=s[2];let l=Math.hypot(r,h,n);let o,u,a;let f,c,d,p;let m,x,M,g;let v,y,w,_;let A,b,C;let S,E,B;let F,O,z;if(Math.abs(l)<dt){return null}l=1/l;r*=l;h*=l;n*=l;o=Math.sin(e);u=Math.cos(e);a=1-u;f=i[0];c=i[1];d=i[2];p=i[3];m=i[4];x=i[5];M=i[6];g=i[7];v=i[8];y=i[9];w=i[10];_=i[11];A=r*r*a+u;b=h*r*a+n*o;C=n*r*a-h*o;S=r*h*a-n*o;E=h*h*a+u;B=n*h*a+r*o;F=r*n*a+h*o;O=h*n*a-r*o;z=n*n*a+u;t[0]=f*A+m*b+v*C;t[1]=c*A+x*b+y*C;t[2]=d*A+M*b+w*C;t[3]=p*A+g*b+_*C;t[4]=f*S+m*E+v*B;t[5]=c*S+x*E+y*B;t[6]=d*S+M*E+w*B;t[7]=p*S+g*E+_*B;t[8]=f*F+m*O+v*z;t[9]=c*F+x*O+y*z;t[10]=d*F+M*O+w*z;t[11]=p*F+g*O+_*z;if(i!==t){t[12]=i[12];t[13]=i[13];t[14]=i[14];t[15]=i[15]}return t}function At(t,i){t[0]=i[12];t[1]=i[13];t[2]=i[14];return t}function bt(t,i){let e=i[0];let s=i[1];let r=i[2];let h=i[4];let n=i[5];let l=i[6];let o=i[8];let u=i[9];let a=i[10];t[0]=Math.hypot(e,s,r);t[1]=Math.hypot(h,n,l);t[2]=Math.hypot(o,u,a);return t}function Ct(t){let i=t[0];let e=t[1];let s=t[2];let r=t[4];let h=t[5];let n=t[6];let l=t[8];let o=t[9];let u=t[10];const a=i*i+e*e+s*s;const f=r*r+h*h+n*n;const c=l*l+o*o+u*u;return Math.sqrt(Math.max(a,f,c))}const St=function(){const t=[1,1,1];return function(i,e){let s=t;bt(s,e);let r=1/s[0];let h=1/s[1];let n=1/s[2];let l=e[0]*r;let o=e[1]*h;let u=e[2]*n;let a=e[4]*r;let f=e[5]*h;let c=e[6]*n;let d=e[8]*r;let p=e[9]*h;let m=e[10]*n;let x=l+f+m;let M=0;if(x>0){M=Math.sqrt(x+1)*2;i[3]=.25*M;i[0]=(c-p)/M;i[1]=(d-u)/M;i[2]=(o-a)/M}else if(l>f&&l>m){M=Math.sqrt(1+l-f-m)*2;i[3]=(c-p)/M;i[0]=.25*M;i[1]=(o+a)/M;i[2]=(d+u)/M}else if(f>m){M=Math.sqrt(1+f-l-m)*2;i[3]=(d-u)/M;i[0]=(o+a)/M;i[1]=.25*M;i[2]=(c+p)/M}else{M=Math.sqrt(1+m-l-f)*2;i[3]=(o-a)/M;i[0]=(d+u)/M;i[1]=(c+p)/M;i[2]=.25*M}return i}}();function Et(t,i,e,s){let h=r([t[0],t[1],t[2]]);const n=r([t[4],t[5],t[6]]);const l=r([t[8],t[9],t[10]]);const o=gt(t);if(o<0)h=-h;e[0]=t[12];e[1]=t[13];e[2]=t[14];const u=t.slice();const a=1/h;const f=1/n;const c=1/l;u[0]*=a;u[1]*=a;u[2]*=a;u[4]*=f;u[5]*=f;u[6]*=f;u[8]*=c;u[9]*=c;u[10]*=c;St(i,u);s[0]=h;s[1]=n;s[2]=l}function Bt(t,i,e,s){const r=t;const h=i[0],n=i[1],l=i[2],o=i[3];const u=h+h,a=n+n,f=l+l;const c=h*u,d=h*a,p=h*f;const m=n*a,x=n*f,M=l*f;const g=o*u,v=o*a,y=o*f;const w=s[0],_=s[1],A=s[2];r[0]=(1-(m+M))*w;r[1]=(d+y)*w;r[2]=(p-v)*w;r[3]=0;r[4]=(d-y)*_;r[5]=(1-(c+M))*_;r[6]=(x+g)*_;r[7]=0;r[8]=(p+v)*A;r[9]=(x-g)*A;r[10]=(1-(c+m))*A;r[11]=0;r[12]=e[0];r[13]=e[1];r[14]=e[2];r[15]=1;return r}function Ft(t,i){let e=i[0],s=i[1],r=i[2],h=i[3];let n=e+e;let l=s+s;let o=r+r;let u=e*n;let a=s*n;let f=s*l;let c=r*n;let d=r*l;let p=r*o;let m=h*n;let x=h*l;let M=h*o;t[0]=1-f-p;t[1]=a+M;t[2]=c-x;t[3]=0;t[4]=a-M;t[5]=1-u-p;t[6]=d+m;t[7]=0;t[8]=c+x;t[9]=d-m;t[10]=1-u-f;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t}function Ot(t,i,e,s,r){let h=1/Math.tan(i/2);let n=1/(s-r);t[0]=h/e;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=h;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=(r+s)*n;t[11]=-1;t[12]=0;t[13]=0;t[14]=2*r*s*n;t[15]=0;return t}function zt(t,i,e,s,r,h,n){let l=1/(i-e);let o=1/(s-r);let u=1/(h-n);t[0]=-2*l;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=-2*o;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=2*u;t[11]=0;t[12]=(i+e)*l;t[13]=(r+s)*o;t[14]=(n+h)*u;t[15]=1;return t}function Lt(t,i,e,s){let r=i[0],h=i[1],n=i[2],l=s[0],o=s[1],u=s[2];let a=r-e[0],f=h-e[1],c=n-e[2];let d=a*a+f*f+c*c;if(d===0){c=1}else{d=1/Math.sqrt(d);a*=d;f*=d;c*=d}let p=o*c-u*f,m=u*a-l*c,x=l*f-o*a;d=p*p+m*m+x*x;if(d===0){if(u){l+=1e-6}else if(o){u+=1e-6}else{o+=1e-6}p=o*c-u*f,m=u*a-l*c,x=l*f-o*a;d=p*p+m*m+x*x}d=1/Math.sqrt(d);p*=d;m*=d;x*=d;t[0]=p;t[1]=m;t[2]=x;t[3]=0;t[4]=f*x-c*m;t[5]=c*p-a*x;t[6]=a*m-f*p;t[7]=0;t[8]=a;t[9]=f;t[10]=c;t[11]=0;t[12]=r;t[13]=h;t[14]=n;t[15]=1;return t}function Xt(t,i,e){t[0]=i[0]+e[0];t[1]=i[1]+e[1];t[2]=i[2]+e[2];t[3]=i[3]+e[3];t[4]=i[4]+e[4];t[5]=i[5]+e[5];t[6]=i[6]+e[6];t[7]=i[7]+e[7];t[8]=i[8]+e[8];t[9]=i[9]+e[9];t[10]=i[10]+e[10];t[11]=i[11]+e[11];t[12]=i[12]+e[12];t[13]=i[13]+e[13];t[14]=i[14]+e[14];t[15]=i[15]+e[15];return t}function Gt(t,i,e){t[0]=i[0]-e[0];t[1]=i[1]-e[1];t[2]=i[2]-e[2];t[3]=i[3]-e[3];t[4]=i[4]-e[4];t[5]=i[5]-e[5];t[6]=i[6]-e[6];t[7]=i[7]-e[7];t[8]=i[8]-e[8];t[9]=i[9]-e[9];t[10]=i[10]-e[10];t[11]=i[11]-e[11];t[12]=i[12]-e[12];t[13]=i[13]-e[13];t[14]=i[14]-e[14];t[15]=i[15]-e[15];return t}function It(t,i,e){t[0]=i[0]*e;t[1]=i[1]*e;t[2]=i[2]*e;t[3]=i[3]*e;t[4]=i[4]*e;t[5]=i[5]*e;t[6]=i[6]*e;t[7]=i[7]*e;t[8]=i[8]*e;t[9]=i[9]*e;t[10]=i[10]*e;t[11]=i[11]*e;t[12]=i[12]*e;t[13]=i[13]*e;t[14]=i[14]*e;t[15]=i[15]*e;return t}class Rt extends Array{constructor(t=1,i=0,e=0,s=0,r=0,h=1,n=0,l=0,o=0,u=0,a=1,f=0,c=0,d=0,p=0,m=1){super(t,i,e,s,r,h,n,l,o,u,a,f,c,d,p,m);return this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,i,e,s,r,h,n,l,o,u,a,f,c,d,p,m){if(t.length)return this.copy(t);mt(this,t,i,e,s,r,h,n,l,o,u,a,f,c,d,p,m);return this}translate(t,i=this){yt(this,i,t);return this}rotate(t,i,e=this){_t(this,e,t,i);return this}scale(t,i=this){wt(this,i,typeof t==="number"?[t,t,t]:t);return this}add(t,i){if(i)Xt(this,t,i);else Xt(this,this,t);return this}sub(t,i){if(i)Gt(this,t,i);else Gt(this,this,t);return this}multiply(t,i){if(!t.length){It(this,this,t)}else if(i){vt(this,t,i)}else{vt(this,this,t)}return this}identity(){xt(this);return this}copy(t){pt(this,t);return this}fromPerspective({fov:t,aspect:i,near:e,far:s}={}){Ot(this,t,i,e,s);return this}fromOrthogonal({left:t,right:i,bottom:e,top:s,near:r,far:h}){zt(this,t,i,e,s,r,h);return this}fromQuaternion(t){Ft(this,t);return this}setPosition(t){this.x=t[0];this.y=t[1];this.z=t[2];return this}inverse(t=this){Mt(this,t);return this}compose(t,i,e){Bt(this,t,i,e);return this}decompose(t,i,e){Et(this,t,i,e);return this}getRotation(t){St(t,this);return this}getTranslation(t){At(t,this);return this}getScaling(t){bt(t,this);return this}getMaxScaleOnAxis(){return Ct(this)}lookAt(t,i,e){Lt(this,t,i,e);return this}determinant(){return gt(this)}fromArray(t,i=0){this[0]=t[i];this[1]=t[i+1];this[2]=t[i+2];this[3]=t[i+3];this[4]=t[i+4];this[5]=t[i+5];this[6]=t[i+6];this[7]=t[i+7];this[8]=t[i+8];this[9]=t[i+9];this[10]=t[i+10];this[11]=t[i+11];this[12]=t[i+12];this[13]=t[i+13];this[14]=t[i+14];this[15]=t[i+15];return this}toArray(t=[],i=0){t[i]=this[0];t[i+1]=this[1];t[i+2]=this[2];t[i+3]=this[3];t[i+4]=this[4];t[i+5]=this[5];t[i+6]=this[6];t[i+7]=this[7];t[i+8]=this[8];t[i+9]=this[9];t[i+10]=this[10];t[i+11]=this[11];t[i+12]=this[12];t[i+13]=this[13];t[i+14]=this[14];t[i+15]=this[15];return t}}function Yt(t,i,e="YXZ"){if(e==="XYZ"){t[1]=Math.asin(Math.min(Math.max(i[8],-1),1));if(Math.abs(i[8])<.99999){t[0]=Math.atan2(-i[9],i[10]);t[2]=Math.atan2(-i[4],i[0])}else{t[0]=Math.atan2(i[6],i[5]);t[2]=0}}else if(e==="YXZ"){t[0]=Math.asin(-Math.min(Math.max(i[9],-1),1));if(Math.abs(i[9])<.99999){t[1]=Math.atan2(i[8],i[10]);t[2]=Math.atan2(i[1],i[5])}else{t[1]=Math.atan2(-i[2],i[0]);t[2]=0}}else if(e==="ZXY"){t[0]=Math.asin(Math.min(Math.max(i[6],-1),1));if(Math.abs(i[6])<.99999){t[1]=Math.atan2(-i[2],i[10]);t[2]=Math.atan2(-i[4],i[5])}else{t[1]=0;t[2]=Math.atan2(i[1],i[0])}}else if(e==="ZYX"){t[1]=Math.asin(-Math.min(Math.max(i[2],-1),1));if(Math.abs(i[2])<.99999){t[0]=Math.atan2(i[6],i[10]);t[2]=Math.atan2(i[1],i[0])}else{t[0]=0;t[2]=Math.atan2(-i[4],i[5])}}else if(e==="YZX"){t[2]=Math.asin(Math.min(Math.max(i[1],-1),1));if(Math.abs(i[1])<.99999){t[0]=Math.atan2(-i[9],i[5]);t[1]=Math.atan2(-i[2],i[0])}else{t[0]=0;t[1]=Math.atan2(i[8],i[10])}}else if(e==="XZY"){t[2]=Math.asin(-Math.min(Math.max(i[4],-1),1));if(Math.abs(i[4])<.99999){t[0]=Math.atan2(i[6],i[5]);t[1]=Math.atan2(i[8],i[0])}else{t[0]=Math.atan2(-i[9],i[10]);t[1]=0}}return t}const Pt=new Rt;class Zt extends Array{constructor(t=0,i=t,e=t,s="YXZ"){super(t,i,e);this.order=s;this.onChange=()=>{};this._target=this;const r=["0","1","2"];return new Proxy(this,{set(t,i){const e=Reflect.set(...arguments);if(e&&r.includes(i))t.onChange();return e}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this._target[0]=t;this.onChange()}set y(t){this._target[1]=t;this.onChange()}set z(t){this._target[2]=t;this.onChange()}set(t,i=t,e=t){if(t.length)return this.copy(t);this._target[0]=t;this._target[1]=i;this._target[2]=e;this.onChange();return this}copy(t){this._target[0]=t[0];this._target[1]=t[1];this._target[2]=t[2];this.onChange();return this}reorder(t){this._target.order=t;this.onChange();return this}fromRotationMatrix(t,i=this.order){Yt(this._target,t,i);this.onChange();return this}fromQuaternion(t,i=this.order,e){Pt.fromQuaternion(t);this._target.fromRotationMatrix(Pt,i);if(!e)this.onChange();return this}fromArray(t,i=0){this._target[0]=t[i];this._target[1]=t[i+1];this._target[2]=t[i+2];return this}toArray(t=[],i=0){t[i]=this[0];t[i+1]=this[1];t[i+2]=this[2];return t}}class Tt{constructor(){this.parent=null;this.children=[];this.visible=true;this.matrix=new Rt;this.worldMatrix=new Rt;this.matrixAutoUpdate=true;this.worldMatrixNeedsUpdate=false;this.position=new B;this.quaternion=new ct;this.scale=new B(1);this.rotation=new Zt;this.up=new B(0,1,0);this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,true);this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,undefined,true)}setParent(t,i=true){if(this.parent&&t!==this.parent)this.parent.removeChild(this,false);this.parent=t;if(i&&t)t.addChild(this,false)}addChild(t,i=true){if(!~this.children.indexOf(t))this.children.push(t);if(i)t.setParent(this,false)}removeChild(t,i=true){if(!!~this.children.indexOf(t))this.children.splice(this.children.indexOf(t),1);if(i)t.setParent(null,false)}updateMatrixWorld(t){if(this.matrixAutoUpdate)this.updateMatrix();if(this.worldMatrixNeedsUpdate||t){if(this.parent===null)this.worldMatrix.copy(this.matrix);else this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix);this.worldMatrixNeedsUpdate=false;t=true}for(let i=0,e=this.children.length;i<e;i++){this.children[i].updateMatrixWorld(t)}}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale);this.worldMatrixNeedsUpdate=true}traverse(t){if(t(this))return;for(let i=0,e=this.children.length;i<e;i++){this.children[i].traverse(t)}}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale);this.rotation.fromQuaternion(this.quaternion)}lookAt(t,i=false){if(i)this.matrix.lookAt(this.position,t,this.up);else this.matrix.lookAt(t,this.position,this.up);this.matrix.getRotation(this.quaternion._target);this.rotation.fromQuaternion(this.quaternion)}}function Wt(t,i){t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[4];t[4]=i[5];t[5]=i[6];t[6]=i[8];t[7]=i[9];t[8]=i[10];return t}function $t(t,i){let e=i[0],s=i[1],r=i[2],h=i[3];let n=e+e;let l=s+s;let o=r+r;let u=e*n;let a=s*n;let f=s*l;let c=r*n;let d=r*l;let p=r*o;let m=h*n;let x=h*l;let M=h*o;t[0]=1-f-p;t[3]=a-M;t[6]=c+x;t[1]=a+M;t[4]=1-u-p;t[7]=d-m;t[2]=c-x;t[5]=d+m;t[8]=1-u-f;return t}function kt(t,i){t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[3];t[4]=i[4];t[5]=i[5];t[6]=i[6];t[7]=i[7];t[8]=i[8];return t}function qt(t,i,e,s,r,h,n,l,o,u){t[0]=i;t[1]=e;t[2]=s;t[3]=r;t[4]=h;t[5]=n;t[6]=l;t[7]=o;t[8]=u;return t}function Nt(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t}function Vt(t,i){let e=i[0],s=i[1],r=i[2];let h=i[3],n=i[4],l=i[5];let o=i[6],u=i[7],a=i[8];let f=a*n-l*u;let c=-a*h+l*o;let d=u*h-n*o;let p=e*f+s*c+r*d;if(!p){return null}p=1/p;t[0]=f*p;t[1]=(-a*s+r*u)*p;t[2]=(l*s-r*n)*p;t[3]=c*p;t[4]=(a*e-r*o)*p;t[5]=(-l*e+r*h)*p;t[6]=d*p;t[7]=(-u*e+s*o)*p;t[8]=(n*e-s*h)*p;return t}function jt(t,i,e){let s=i[0],r=i[1],h=i[2];let n=i[3],l=i[4],o=i[5];let u=i[6],a=i[7],f=i[8];let c=e[0],d=e[1],p=e[2];let m=e[3],x=e[4],M=e[5];let g=e[6],v=e[7],y=e[8];t[0]=c*s+d*n+p*u;t[1]=c*r+d*l+p*a;t[2]=c*h+d*o+p*f;t[3]=m*s+x*n+M*u;t[4]=m*r+x*l+M*a;t[5]=m*h+x*o+M*f;t[6]=g*s+v*n+y*u;t[7]=g*r+v*l+y*a;t[8]=g*h+v*o+y*f;return t}function Dt(t,i,e){let s=i[0],r=i[1],h=i[2],n=i[3],l=i[4],o=i[5],u=i[6],a=i[7],f=i[8],c=e[0],d=e[1];t[0]=s;t[1]=r;t[2]=h;t[3]=n;t[4]=l;t[5]=o;t[6]=c*s+d*n+u;t[7]=c*r+d*l+a;t[8]=c*h+d*o+f;return t}function Qt(t,i,e){let s=i[0],r=i[1],h=i[2],n=i[3],l=i[4],o=i[5],u=i[6],a=i[7],f=i[8],c=Math.sin(e),d=Math.cos(e);t[0]=d*s+c*n;t[1]=d*r+c*l;t[2]=d*h+c*o;t[3]=d*n-c*s;t[4]=d*l-c*r;t[5]=d*o-c*h;t[6]=u;t[7]=a;t[8]=f;return t}function Ut(t,i,e){let s=e[0],r=e[1];t[0]=s*i[0];t[1]=s*i[1];t[2]=s*i[2];t[3]=r*i[3];t[4]=r*i[4];t[5]=r*i[5];t[6]=i[6];t[7]=i[7];t[8]=i[8];return t}function Ht(t,i){let e=i[0],s=i[1],r=i[2],h=i[3];let n=i[4],l=i[5],o=i[6],u=i[7];let a=i[8],f=i[9],c=i[10],d=i[11];let p=i[12],m=i[13],x=i[14],M=i[15];let g=e*l-s*n;let v=e*o-r*n;let y=e*u-h*n;let w=s*o-r*l;let _=s*u-h*l;let A=r*u-h*o;let b=a*m-f*p;let C=a*x-c*p;let S=a*M-d*p;let E=f*x-c*m;let B=f*M-d*m;let F=c*M-d*x;let O=g*F-v*B+y*E+w*S-_*C+A*b;if(!O){return null}O=1/O;t[0]=(l*F-o*B+u*E)*O;t[1]=(o*S-n*F-u*C)*O;t[2]=(n*B-l*S+u*b)*O;t[3]=(r*B-s*F-h*E)*O;t[4]=(e*F-r*S+h*C)*O;t[5]=(s*S-e*B-h*b)*O;t[6]=(m*A-x*_+M*w)*O;t[7]=(x*y-p*A-M*v)*O;t[8]=(p*_-m*y+M*g)*O;return t}class Kt extends Array{constructor(t=1,i=0,e=0,s=0,r=1,h=0,n=0,l=0,o=1){super(t,i,e,s,r,h,n,l,o);return this}set(t,i,e,s,r,h,n,l,o){if(t.length)return this.copy(t);qt(this,t,i,e,s,r,h,n,l,o);return this}translate(t,i=this){Dt(this,i,t);return this}rotate(t,i=this){Qt(this,i,t);return this}scale(t,i=this){Ut(this,i,t);return this}multiply(t,i){if(i){jt(this,t,i)}else{jt(this,this,t)}return this}identity(){Nt(this);return this}copy(t){kt(this,t);return this}fromMatrix4(t){Wt(this,t);return this}fromQuaternion(t){$t(this,t);return this}fromBasis(t,i,e){this.set(t[0],t[1],t[2],i[0],i[1],i[2],e[0],e[1],e[2]);return this}inverse(t=this){Vt(this,t);return this}getNormalMatrix(t){Ht(this,t);return this}}let Jt=0;class ti extends Tt{constructor(t,{geometry:i,program:e,mode:s=t.TRIANGLES,frustumCulled:r=true,renderOrder:h=0}={}){super();if(!t.canvas)console.error("gl not passed as first argument to Mesh");this.gl=t;this.id=Jt++;this.geometry=i;this.program=e;this.mode=s;this.frustumCulled=r;this.renderOrder=h;this.modelViewMatrix=new Rt;this.normalMatrix=new Kt;this.beforeRenderCallbacks=[];this.afterRenderCallbacks=[]}onBeforeRender(t){this.beforeRenderCallbacks.push(t);return this}onAfterRender(t){this.afterRenderCallbacks.push(t);return this}draw({camera:t}={}){if(t){if(!this.program.uniforms.modelMatrix){Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}})}this.program.uniforms.projectionMatrix.value=t.projectionMatrix;this.program.uniforms.cameraPosition.value=t.worldPosition;this.program.uniforms.viewMatrix.value=t.viewMatrix;this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix);this.normalMatrix.getNormalMatrix(this.modelViewMatrix);this.program.uniforms.modelMatrix.value=this.worldMatrix;this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix;this.program.uniforms.normalMatrix.value=this.normalMatrix}this.beforeRenderCallbacks.forEach((i=>i&&i({mesh:this,camera:t})));let i=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:i});this.geometry.draw({mode:this.mode,program:this.program});this.afterRenderCallbacks.forEach((i=>i&&i({mesh:this,camera:t})))}}const ii={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function ei(t){if(t.length===4)t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3];const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!i)console.warn(`Unable to convert hex string ${t} to rgb values`);return[parseInt(i[1],16)/255,parseInt(i[2],16)/255,parseInt(i[3],16)/255]}function si(t){t=parseInt(t);return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function ri(t){if(t===undefined)return[0,0,0];if(arguments.length===3)return arguments;if(!isNaN(t))return si(t);if(t[0]==="#")return ei(t);if(ii[t.toLowerCase()])return ei(ii[t.toLowerCase()]);console.warn("Color format not recognised");return[0,0,0]}class hi extends Array{constructor(t){if(Array.isArray(t))return super(...t);return super(...ri(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(t){this[0]=t}set g(t){this[1]=t}set b(t){this[2]=t}set(t){if(Array.isArray(t))return this.copy(t);return this.copy(ri(...arguments))}copy(t){this[0]=t[0];this[1]=t[1];this[2]=t[2];return this}}class ni extends X{constructor(t,{attributes:i={}}={}){Object.assign(i,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}});super(t,i)}}const li=":host{display:block;width:100%;height:100%}canvas{width:100% !important;height:100% !important}";const oi=`#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n`;const ui=`#version 300 es\nprecision highp float;\n\nuniform float uTime;\nuniform float uAmplitude;\nuniform vec3 uColorStops[3];\nuniform vec2 uResolution;\nuniform float uBlend;\n\nout vec4 fragColor;\n\nvec3 permute(vec3 x) {\n  return mod(((x * 34.0) + 1.0) * x, 289.0);\n}\n\nfloat snoise(vec2 v){\n  const vec4 C = vec4(\n      0.211324865405187, 0.366025403784439,\n      -0.577350269189626, 0.024390243902439\n  );\n  vec2 i  = floor(v + dot(v, C.yy));\n  vec2 x0 = v - i + dot(i, C.xx);\n  vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod(i, 289.0);\n\n  vec3 p = permute(\n      permute(i.y + vec3(0.0, i1.y, 1.0))\n    + i.x + vec3(0.0, i1.x, 1.0)\n  );\n\n  vec3 m = max(\n      0.5 - vec3(\n          dot(x0, x0),\n          dot(x12.xy, x12.xy),\n          dot(x12.zw, x12.zw)\n      ),\n      0.0\n  );\n  m = m * m;\n  m = m * m;\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nstruct ColorStop {\n  vec3 color;\n  float position;\n};\n\n#define COLOR_RAMP(colors, factor, finalColor) {                int index = 0;                                              for (int i = 0; i < 2; i++) {                                    ColorStop currentColor = colors[i];                         bool isInBetween = currentColor.position <= factor;         index = int(mix(float(index), float(i), float(isInBetween)));   }                                                           ColorStop currentColor = colors[index];                     ColorStop nextColor = colors[index + 1];                    float range = nextColor.position - currentColor.position;   float lerpFactor = (factor - currentColor.position) / range;   finalColor = mix(currentColor.color, nextColor.color, lerpFactor); }\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / uResolution;\n\n  ColorStop colors[3];\n  colors[0] = ColorStop(uColorStops[0], 0.0);\n  colors[1] = ColorStop(uColorStops[1], 0.5);\n  colors[2] = ColorStop(uColorStops[2], 1.0);\n\n  vec3 rampColor;\n  COLOR_RAMP(colors, uv.x, rampColor);\n\n  float height = snoise(vec2(uv.x * 2.0 + uTime * 0.1, uTime * 0.25)) * 0.5 * uAmplitude;\n  height = exp(height);\n  height = (uv.y * 2.0 - height + 0.2);\n  float intensity = 0.6 * height;\n\n  float midPoint = 0.20;\n  float auroraAlpha = smoothstep(midPoint - uBlend * 0.5, midPoint + uBlend * 0.5, intensity);\n\n  vec3 auroraColor = intensity * rampColor;\n\n  fragColor = vec4(auroraColor * auroraAlpha, auroraAlpha);\n}\n`;const ai=class{constructor(i){t(this,i)}animateId=0;renderer;program;mesh;get el(){return i(this)}colorStops=["#5227FF","#7cff67","#5227FF"];amplitude=1;blend=.5;speed=1;time;connectedCallback(){console.log("connected");let t=this.el.shadowRoot.querySelector("canvas");if(!t){t=document.createElement("canvas");console.log({...t}.width);this.el.shadowRoot.appendChild(t)}this.renderer=new V({canvas:t,alpha:true,premultipliedAlpha:true,antialias:true,width:this.el.offsetWidth,height:this.el.offsetHeight});const{amplitude:i,blend:e,colorStops:s,renderer:r}=this;const{gl:h}=r;h.clearColor(0,0,0,0);h.enable(h.BLEND);h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA);h.canvas.style.backgroundColor="transparent";const n=s.map((t=>{const i=new hi(t);return[i.r,i.g,i.b]}));this.program=new R(h,{vertex:oi,fragment:ui,uniforms:{uTime:{value:0},uAmplitude:{value:i},uColorStops:{value:n},uResolution:{value:[this.el.offsetWidth,this.el.offsetHeight]},uBlend:{value:e}}});const l=new ni(h);if(l.attributes.uv){delete l.attributes.uv}this.mesh=new ti(h,{geometry:l,program:this.program});this.animateId=requestAnimationFrame(this.update);window.addEventListener("resize",this.resize);this.resize()}disconnectCallback(){cancelAnimationFrame(this.animateId);window.removeEventListener("resize",this.resize);const{renderer:t}=this;const{gl:i}=t||{};i.getExtension("WEBGL_lose_context")?.loseContext()}resize=()=>{console.log("resize",this.el);if(!this.el)return;const t=this.el.offsetWidth;const i=this.el.offsetHeight;this.renderer.setSize(t,i);if(this.program){this.program.uniforms.uResolution.value=[t,i]}this.renderer.render({scene:this.mesh})};update=t=>{this.animateId=requestAnimationFrame(this.update);const{program:i,renderer:e,amplitude:s,blend:r,colorStops:h,time:n=t*.01,speed:l=1}=this;i.uniforms.uTime.value=n*l*.1;i.uniforms.uAmplitude.value=s;i.uniforms.uBlend.value=r;i.uniforms.uColorStops.value=h.map((t=>{const i=new hi(t);return[i.r,i.g,i.b]}));e.render({scene:this.mesh})};render(){return e(s,{key:"51a5d3dde06ee00ad00b0feb065316b6b1eae4b7"})}};ai.style=li;export{ai as prx_bg_aurora};
//# sourceMappingURL=p-2639d7cb.entry.js.map