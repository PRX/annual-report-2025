import{r as t,g as e,h as i,H as s}from"./p-Dqx6Rc4F.js";const n="@property --prx-audio-quote--progress {\n  syntax: '<number>';\n  inherits: true;\n  initial-value: 0;\n}\n\n@property --prx-audio-quote--word--color {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--word--color--heard {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--word--color--playing {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--word--color--active {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--cite--color {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--button--color {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--button--color--hover {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--button--color--playing {\n  syntax: '<color>';\n  inherits: true;\n  initial-value: unset;\n}\n\n@property --prx-audio-quote--button--size {\n  syntax: '<length>';\n  inherits: true;\n  initial-value: unset;\n}\n\n.sc-prx-audio-quote-h {\n  --_word--color: var(--prx-audio-quote--word--color, currentColor);\n  --_word--color--heard: var(--prx-audio-quote--word--color--heard, var(--_word--color));\n  --_word--color--playing: var(--prx-audio-quote--word--color--playing, color(from var(--_word--color--heard) srgb r g b / 0.5));\n  --_word--color--active: var(--prx-audio-quote--word--color--active, hsl(calc(var(--prx-audio-quote--progress) * 360) 100% 60%));\n  --_cite--color: var(--prx-audio-quote--cite--color, currentColor);\n  --_button--color: var(--prx-audio-quote--button--color, var(--_word--color--active));\n  --_button--color--hover: var(--prx-audio-quote--button--color--hover, hsl(from var(--_button--color) h s calc(l / 1.5)));\n  --_button--color--playing: var(--prx-audio-quote--button--color--playing, var(--_button--color));\n  --_button--size: var(--prx-audio-quote--button--size, 2rem);\n\n  transition: --prx-audio-quote--progress 200ms cubic-bezier(0.47, 0, 0.745, 0.715);\n\n  display: block;\n}\n\nblockquote.sc-prx-audio-quote {\n  display: grid;\n  grid-template-columns: var(--_button--size) 1fr;\n  grid-template-rows: 1fr min-content;\n  grid-template-areas:\n    'QUOTE QUOTE'\n    'CITE CITE';\n  gap: 1rem;\n\n  padding: 0;\n  margin: 0;\n\n  > * {\n    margin: 0;\n  }\n}\n\nprx-quote.sc-prx-audio-quote {\n  grid-area: QUOTE;\n\n  position: relative;\n  isolation: isolate;\n\n  quotes: \"“\" \"”\" \"‘\" \"’\";\n\n  > :first-child::before {\n    content: open-quote;\n    position: absolute;\n    top: 0;\n    right: calc(100% + 0.25ch);\n  }\n\n  > :last-child::after {\n    content: close-quote;\n  }\n\n  > * {\n    margin: 0;\n\n    & + * {\n      margin-block-start: 1.2em;\n    }\n  }\n}\n\nprx-audio-quote-controls.sc-prx-audio-quote {\n  container-name: controls;\n  container-type: size;\n\n  grid-area: CONTROLS;\n\n  display: grid;\n  grid-template-columns: var(--_button--size);\n  grid-template-rows: calc(max(0px, var(--prx-audio-quote--progress) * 100% - var(--_button--size))) var(--_button--size) auto;\n  grid-template-areas:\n    'BEFORE'\n    'BUTTON'\n    'AFTER';\n  justify-items: center;\n\n  &::before,\n  &::after {\n    content: '';\n    display: block;\n    width: 0.25rem;\n\n    border-radius: 100vw;\n  }\n\n  &::before {\n    grid-area: BEFORE;\n\n    margin-block-end: 0.25rem;\n\n    background-color: var(--_word--color--heard);\n  }\n\n  &::after {\n    grid-area: AFTER;\n\n    margin-block-start: 0.25rem;\n\n    background-color: var(--_word--color--playing);\n  }\n}\n\n.word.sc-prx-audio-quote {\n  transition: color 200ms linear;\n  color: var(--_word--color);\n}\n\n.sc-prx-audio-quote-h:has(prx-audio-quote-controls) {\n  blockquote {\n    grid-template-areas:\n      'CONTROLS QUOTE'\n      'CITE CITE';\n  }\n}\n\n.sc-prx-audio-quote-h:where([playing]):where([highlight]) {\n  .word {\n    color: var(--_word--color--heard);\n\n    &.active {\n      color: var(--_word--color--active);\n    }\n\n    &:not(:where(.heard, .active)) {\n      color: var(--_word--color--playing);\n    }\n  }\n}\n\ncite.sc-prx-audio-quote {\n  grid-area: CITE;\n  justify-self: end;\n\n  color: var(--_cite--color);\n\n  &::before {\n    content: '\\2014\\00a0';\n  }\n}\n\n.play-button.sc-prx-audio-quote {\n  grid-area: BUTTON;\n\n  display: grid;\n  align-items: center;\n  width: var(--_button--size);\n  aspect-ratio: 1;\n  z-index: 1;\n\n  padding: 0.5em;\n\n  background: none;\n\n  color: var(--_button--color);\n\n  border: none;\n  border-radius: 100vw;\n\n  cursor: pointer;\n\n  &:is(:hover) {\n    color: var(--_button--color--hover);\n  }\n\n  :where([playing]) & {\n    color: var(--_button--color--playing);\n  }\n}\n\n.play-icon.sc-prx-audio-quote {\n  container-name: icon;\n  container-type: size;\n\n  display: inline-grid;\n  grid-template-rows: 100%; \n  justify-items: center;\n  align-items: center;\n  width: 100%;\n  aspect-ratio: 1;\n\n  &::before,\n  &::after {\n    content: '';\n\n    grid-area: 1 / 1 / -1 / -1;\n    display: block;\n  }\n\n  &::before {\n    width: 0;\n    height: 0;\n\n    border-inline-start: 75cqw solid currentColor;\n    border-inline-end: 0 solid currentColor;\n    border-block: 50cqh solid transparent;\n\n    line-height: 0;\n  }\n\n  &::after {\n    display: none;\n    box-sizing: border-box;\n    width: 100cqw;\n    aspect-ratio: 1;\n\n    border-inline-start: 35cqw solid currentColor;\n    border-inline-end: 35cqw solid currentColor;\n    border-block: 0 solid transparent;\n  }\n\n  [playing] & {\n    &::before {\n      display: none;\n    }\n\n    &::after {\n      display: block;\n    }\n  }\n}\n\n.restart-button.sc-prx-audio-quote {\n  grid-area: BEFORE;\n\n  z-index: 1;\n\n  border: none;\n\n  background: none;\n\n  cursor: n-resize;\n}";const r=class{constructor(e){t(this,e)}get el(){return e(this)}src;transcriptUrl;playing=false;progress=0;audioEl;trackEl;wordSpans=[];currentWordIndex=0;wrapWordsInSpans=t=>{const e=this;if(t.nodeType===Node.TEXT_NODE){const i=t.textContent.trim();if(i.length>0){const s=i.split(/\s+/);const n=document.createDocumentFragment();s.forEach(((i,r)=>{if(i.length>0){const h=document.createElement("span");h.textContent=i;h.classList.add("word");n.appendChild(h);e.wordSpans.push(h);if(r<s.length-1||t.nextSibling){n.appendChild(document.createTextNode(" "))}}}));t.parentNode.replaceChild(n,t)}}else if(t.nodeType===Node.ELEMENT_NODE){const e=Array.from(t.childNodes);e.forEach((t=>this.wrapWordsInSpans(t)))}};prepareWordForCompare=t=>t.replaceAll(/[^\w]/g,"").toLowerCase();reset=()=>{this.audioEl.currentTime=0;this.currentWordIndex=0;this.wordSpans.forEach((t=>t.classList.remove("heard","active")))};handleCueChange=t=>{const e=t.target.track.activeCues;const i=e[0];const{text:s,startTime:n}=i||{};if(!s)return;const r=this.prepareWordForCompare(s);const h=this.el.querySelector("span.word.active");const o=this.currentWordIndex+this.wordSpans.slice(this.currentWordIndex).findIndex((t=>this.prepareWordForCompare(t.textContent)===r));if(o<0||o>this.currentWordIndex+3){console.log(`Transcript word out of sync with quote text. "${s}" @ ${n} seconds.`);return}const l=this.wordSpans.at(o);h?.classList.remove("active");this.wordSpans.forEach((t=>{t.classList.remove("heard")}));if(!this.playing)return;l.classList.add("active");this.wordSpans.slice(0,o).forEach((t=>{t.classList.add("heard")}));this.currentWordIndex=o};handlePlayToggleClick=()=>{const{paused:t}=this.audioEl;if(t){this.audioEl.play()}else{this.audioEl.pause()}};handleRestartClick=()=>{this.reset()};connectedCallback(){const{el:t,src:e,transcriptUrl:i}=this;if(!e)return;const s=t.querySelector("blockquote");if(i&&!s){const e=t.querySelector("[slot=citation]");e?.remove();this.wrapWordsInSpans(t);t.appendChild(e)}this.audioEl=document.createElement("audio");this.audioEl.crossOrigin="anonymous";this.audioEl.preload="none";this.audioEl.src=e;this.audioEl.addEventListener("timeupdate",(()=>{const{currentTime:t,duration:e}=this.audioEl;this.progress=t/e}));this.audioEl.addEventListener("play",(()=>{this.playing=true}));this.audioEl.addEventListener("pause",(()=>{this.playing=false}));this.audioEl.addEventListener("ended",(()=>{this.reset()}));if(this.transcriptUrl?.length){this.trackEl=document.createElement("track");this.trackEl.default=true;this.trackEl.kind="captions";this.trackEl.src=i;this.trackEl.addEventListener("cuechange",this.handleCueChange);this.audioEl.appendChild(this.trackEl)}}disconnectCallback(){this.audioEl=null;this.trackEl=null}render(){const{playing:t,progress:e,src:n,transcriptUrl:r,handlePlayToggleClick:h,handleRestartClick:o}=this;const l=!!n?.length;const a=!!r?.length;return i(s,{key:"8a33b8b8111da99b7eb43a1e386573a66471c315",playing:t,highlight:a,style:{"--prx-audio-quote--progress":`${e}`}},i("blockquote",{key:"84f08169528edb288686a7d9cc882af69992d7c2"},i("prx-quote",{key:"74f1c3a277de510099bfd4b4dc698ef135ace61d"},i("slot",{key:"0d1d9ed4fe1605e2206ef217d7bd966bbdf3581f"})),i("cite",{key:"08dc95fc127720ba596ce255273c9cf8c9ebd709"},i("slot",{key:"a4133a1e09bdaa26134db5c3da71d628b42524ab",name:"citation"})),l&&i("prx-audio-quote-controls",{key:"18e5ee9e755c1913e85f1555e4b6f1b42b92a198"},i("button",{key:"7e6535875b81469c7759a50759a107980948a344",type:"button",class:"restart-button",onClick:o,"aria-label":"Restart"}),i("button",{key:"649cd0a23c6c63bf4ce20634857882435f61a03d",type:"button",class:"play-button",onClick:h,"aria-label":t?"Pause":"Play"},i("span",{key:"abbff218f81e66f3dbcc25382af93c68939e032e",class:"play-icon"})))))}};r.style=n;function h(t){let e=t[0];let i=t[1];let s=t[2];return Math.sqrt(e*e+i*i+s*s)}function o(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function l(t,e,i,s){t[0]=e;t[1]=i;t[2]=s;return t}function a(t,e,i){t[0]=e[0]+i[0];t[1]=e[1]+i[1];t[2]=e[2]+i[2];return t}function u(t,e,i){t[0]=e[0]-i[0];t[1]=e[1]-i[1];t[2]=e[2]-i[2];return t}function c(t,e,i){t[0]=e[0]*i[0];t[1]=e[1]*i[1];t[2]=e[2]*i[2];return t}function f(t,e,i){t[0]=e[0]/i[0];t[1]=e[1]/i[1];t[2]=e[2]/i[2];return t}function d(t,e,i){t[0]=e[0]*i;t[1]=e[1]*i;t[2]=e[2]*i;return t}function p(t,e){let i=e[0]-t[0];let s=e[1]-t[1];let n=e[2]-t[2];return Math.sqrt(i*i+s*s+n*n)}function m(t,e){let i=e[0]-t[0];let s=e[1]-t[1];let n=e[2]-t[2];return i*i+s*s+n*n}function x(t){let e=t[0];let i=t[1];let s=t[2];return e*e+i*i+s*s}function g(t,e){t[0]=-e[0];t[1]=-e[1];t[2]=-e[2];return t}function y(t,e){t[0]=1/e[0];t[1]=1/e[1];t[2]=1/e[2];return t}function b(t,e){let i=e[0];let s=e[1];let n=e[2];let r=i*i+s*s+n*n;if(r>0){r=1/Math.sqrt(r)}t[0]=e[0]*r;t[1]=e[1]*r;t[2]=e[2]*r;return t}function v(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function w(t,e,i){let s=e[0],n=e[1],r=e[2];let h=i[0],o=i[1],l=i[2];t[0]=n*l-r*o;t[1]=r*h-s*l;t[2]=s*o-n*h;return t}function M(t,e,i,s){let n=e[0];let r=e[1];let h=e[2];t[0]=n+s*(i[0]-n);t[1]=r+s*(i[1]-r);t[2]=h+s*(i[2]-h);return t}function _(t,e,i,s,n){const r=Math.exp(-s*n);let h=e[0];let o=e[1];let l=e[2];t[0]=i[0]+(h-i[0])*r;t[1]=i[1]+(o-i[1])*r;t[2]=i[2]+(l-i[2])*r;return t}function C(t,e,i){let s=e[0],n=e[1],r=e[2];let h=i[3]*s+i[7]*n+i[11]*r+i[15];h=h||1;t[0]=(i[0]*s+i[4]*n+i[8]*r+i[12])/h;t[1]=(i[1]*s+i[5]*n+i[9]*r+i[13])/h;t[2]=(i[2]*s+i[6]*n+i[10]*r+i[14])/h;return t}function A(t,e,i){let s=e[0],n=e[1],r=e[2];let h=i[3]*s+i[7]*n+i[11]*r+i[15];h=h||1;t[0]=(i[0]*s+i[4]*n+i[8]*r)/h;t[1]=(i[1]*s+i[5]*n+i[9]*r)/h;t[2]=(i[2]*s+i[6]*n+i[10]*r)/h;return t}function q(t,e,i){let s=e[0],n=e[1],r=e[2];t[0]=s*i[0]+n*i[3]+r*i[6];t[1]=s*i[1]+n*i[4]+r*i[7];t[2]=s*i[2]+n*i[5]+r*i[8];return t}function E(t,e,i){let s=e[0],n=e[1],r=e[2];let h=i[0],o=i[1],l=i[2],a=i[3];let u=o*r-l*n;let c=l*s-h*r;let f=h*n-o*s;let d=o*f-l*c;let p=l*u-h*f;let m=h*c-o*u;let x=a*2;u*=x;c*=x;f*=x;d*=2;p*=2;m*=2;t[0]=s+u+d;t[1]=n+c+p;t[2]=r+f+m;return t}const k=function(){const t=[0,0,0];const e=[0,0,0];return function(i,s){o(t,i);o(e,s);b(t,t);b(e,e);let n=v(t,e);if(n>1){return 0}else if(n<-1){return Math.PI}else{return Math.acos(n)}}}();function S(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}class O extends Array{constructor(t=0,e=t,i=t){super(t,e,i);return this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,i=t){if(t.length)return this.copy(t);l(this,t,e,i);return this}copy(t){o(this,t);return this}add(t,e){if(e)a(this,t,e);else a(this,this,t);return this}sub(t,e){if(e)u(this,t,e);else u(this,this,t);return this}multiply(t){if(t.length)c(this,this,t);else d(this,this,t);return this}divide(t){if(t.length)f(this,this,t);else d(this,this,1/t);return this}inverse(t=this){y(this,t);return this}len(){return h(this)}distance(t){if(t)return p(this,t);else return h(this)}squaredLen(){return x(this)}squaredDistance(t){if(t)return m(this,t);else return x(this)}negate(t=this){g(this,t);return this}cross(t,e){if(e)w(this,t,e);else w(this,this,t);return this}scale(t){d(this,this,t);return this}normalize(){b(this,this);return this}dot(t){return v(this,t)}equals(t){return S(this,t)}applyMatrix3(t){q(this,this,t);return this}applyMatrix4(t){C(this,this,t);return this}scaleRotateMatrix4(t){A(this,this,t);return this}applyQuaternion(t){E(this,this,t);return this}angle(t){return k(this,t)}lerp(t,e){M(this,this,t,e);return this}smoothLerp(t,e,i){_(this,this,t,e,i);return this}clone(){return new O(this[0],this[1],this[2])}fromArray(t,e=0){this[0]=t[e];this[1]=t[e+1];this[2]=t[e+2];return this}toArray(t=[],e=0){t[e]=this[0];t[e+1]=this[1];t[e+2]=this[2];return t}transformDirection(t){const e=this[0];const i=this[1];const s=this[2];this[0]=t[0]*e+t[4]*i+t[8]*s;this[1]=t[1]*e+t[5]*i+t[9]*s;this[2]=t[2]*e+t[6]*i+t[10]*s;return this.normalize()}}const z=new O;let B=1;let F=1;let T=false;class R{constructor(t,e={}){if(!t.canvas)console.error("gl not passed as first argument to Geometry");this.gl=t;this.attributes=e;this.id=B++;this.VAOs={};this.drawRange={start:0,count:0};this.instancedCount=0;this.gl.renderer.bindVertexArray(null);this.gl.renderer.currentGeometry=null;this.glState=this.gl.renderer.state;for(let t in e){this.addAttribute(t,e[t])}}addAttribute(t,e){this.attributes[t]=e;e.id=F++;e.size=e.size||1;e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT);e.target=t==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER;e.normalized=e.normalized||false;e.stride=e.stride||0;e.offset=e.offset||0;e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size);e.divisor=e.instanced||0;e.needsUpdate=false;e.usage=e.usage||this.gl.STATIC_DRAW;if(!e.buffer){this.updateAttribute(e)}if(e.divisor){this.isInstanced=true;if(this.instancedCount&&this.instancedCount!==e.count*e.divisor){console.warn("geometry has multiple instanced buffers of different length");return this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor)}this.instancedCount=e.count*e.divisor}else if(t==="index"){this.drawRange.count=e.count}else if(!this.attributes.index){this.drawRange.count=Math.max(this.drawRange.count,e.count)}}updateAttribute(t){const e=!t.buffer;if(e)t.buffer=this.gl.createBuffer();if(this.glState.boundBuffer!==t.buffer){this.gl.bindBuffer(t.target,t.buffer);this.glState.boundBuffer=t.buffer}if(e){this.gl.bufferData(t.target,t.data,t.usage)}else{this.gl.bufferSubData(t.target,0,t.data)}t.needsUpdate=false}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t;this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray();this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]);this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:i})=>{if(!this.attributes[e]){console.warn(`active attribute ${e} not being supplied`);return}const s=this.attributes[e];this.gl.bindBuffer(s.target,s.buffer);this.glState.boundBuffer=s.buffer;let n=1;if(i===35674)n=2;if(i===35675)n=3;if(i===35676)n=4;const r=s.size/n;const h=n===1?0:n*n*4;const o=n===1?0:n*4;for(let e=0;e<n;e++){this.gl.vertexAttribPointer(t+e,r,s.type,s.normalized,s.stride+h,s.offset+e*o);this.gl.enableVertexAttribArray(t+e);this.gl.renderer.vertexAttribDivisor(t+e,s.divisor)}}));if(this.attributes.index)this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){if(this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`){if(!this.VAOs[t.attributeOrder])this.createVAO(t);this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]);this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`}t.attributeLocations.forEach(((t,{name:e})=>{const i=this.attributes[e];if(i.needsUpdate)this.updateAttribute(i)}));let i=2;if(this.attributes.index?.type===this.gl.UNSIGNED_INT)i=4;if(this.isInstanced){if(this.attributes.index){this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*i,this.instancedCount)}else{this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount)}}else{if(this.attributes.index){this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*i)}else{this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}}}getPosition(){const t=this.attributes.position;if(t.data)return t;if(T)return;console.warn("No position buffer data found to compute bounds");return T=true}computeBoundingBox(t){if(!t)t=this.getPosition();const e=t.data;const i=t.size;if(!this.bounds){this.bounds={min:new O,max:new O,center:new O,scale:new O,radius:Infinity}}const s=this.bounds.min;const n=this.bounds.max;const r=this.bounds.center;const h=this.bounds.scale;s.set(+Infinity);n.set(-Infinity);for(let t=0,r=e.length;t<r;t+=i){const i=e[t];const r=e[t+1];const h=e[t+2];s.x=Math.min(i,s.x);s.y=Math.min(r,s.y);s.z=Math.min(h,s.z);n.x=Math.max(i,n.x);n.y=Math.max(r,n.y);n.z=Math.max(h,n.z)}h.sub(n,s);r.add(s,n).divide(2)}computeBoundingSphere(t){if(!t)t=this.getPosition();const e=t.data;const i=t.size;if(!this.bounds)this.computeBoundingBox(t);let s=0;for(let t=0,n=e.length;t<n;t+=i){z.fromArray(e,t);s=Math.max(s,this.bounds.center.squaredDistance(z))}this.bounds.radius=Math.sqrt(s)}remove(){for(let t in this.VAOs){this.gl.renderer.deleteVertexArray(this.VAOs[t]);delete this.VAOs[t]}for(let t in this.attributes){this.gl.deleteBuffer(this.attributes[t].buffer);delete this.attributes[t]}}}let I=1;const L={};class X{constructor(t,{vertex:e,fragment:i,uniforms:s={},transparent:n=false,cullFace:r=t.BACK,frontFace:h=t.CCW,depthTest:o=true,depthWrite:l=true,depthFunc:a=t.LEQUAL}={}){if(!t.canvas)console.error("gl not passed as first argument to Program");this.gl=t;this.uniforms=s;this.id=I++;if(!e)console.warn("vertex shader not supplied");if(!i)console.warn("fragment shader not supplied");this.transparent=n;this.cullFace=r;this.frontFace=h;this.depthTest=o;this.depthWrite=l;this.depthFunc=a;this.blendFunc={};this.blendEquation={};this.stencilFunc={};this.stencilOp={};if(this.transparent&&!this.blendFunc.src){if(this.gl.renderer.premultipliedAlpha)this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);else this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}this.vertexShader=t.createShader(t.VERTEX_SHADER);this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);this.program=t.createProgram();t.attachShader(this.program,this.vertexShader);t.attachShader(this.program,this.fragmentShader);this.setShaders({vertex:e,fragment:i})}setShaders({vertex:t,fragment:e}){if(t){this.gl.shaderSource(this.vertexShader,t);this.gl.compileShader(this.vertexShader);if(this.gl.getShaderInfoLog(this.vertexShader)!==""){console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}\nVertex Shader\n${G(t)}`)}}if(e){this.gl.shaderSource(this.fragmentShader,e);this.gl.compileShader(this.fragmentShader);if(this.gl.getShaderInfoLog(this.fragmentShader)!==""){console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}\nFragment Shader\n${G(e)}`)}}this.gl.linkProgram(this.program);if(!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)){return console.warn(this.gl.getProgramInfoLog(this.program))}this.uniformLocations=new Map;let i=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let t=0;t<i;t++){let e=this.gl.getActiveUniform(this.program,t);this.uniformLocations.set(e,this.gl.getUniformLocation(this.program,e.name));const i=e.name.match(/(\w+)/g);e.uniformName=i[0];e.nameComponents=i.slice(1)}this.attributeLocations=new Map;const s=[];const n=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let t=0;t<n;t++){const e=this.gl.getActiveAttrib(this.program,t);const i=this.gl.getAttribLocation(this.program,e.name);if(i===-1)continue;s[i]=e.name;this.attributeLocations.set(e,i)}this.attributeOrder=s.join("")}setBlendFunc(t,e,i,s){this.blendFunc.src=t;this.blendFunc.dst=e;this.blendFunc.srcAlpha=i;this.blendFunc.dstAlpha=s;if(t)this.transparent=true}setBlendEquation(t,e){this.blendEquation.modeRGB=t;this.blendEquation.modeAlpha=e}setStencilFunc(t,e,i){this.stencilRef=e;this.stencilFunc.func=t;this.stencilFunc.ref=e;this.stencilFunc.mask=i}setStencilOp(t,e,i){this.stencilOp.stencilFail=t;this.stencilOp.depthFail=e;this.stencilOp.depthPass=i}applyState(){if(this.depthTest)this.gl.renderer.enable(this.gl.DEPTH_TEST);else this.gl.renderer.disable(this.gl.DEPTH_TEST);if(this.cullFace)this.gl.renderer.enable(this.gl.CULL_FACE);else this.gl.renderer.disable(this.gl.CULL_FACE);if(this.blendFunc.src)this.gl.renderer.enable(this.gl.BLEND);else this.gl.renderer.disable(this.gl.BLEND);if(this.cullFace)this.gl.renderer.setCullFace(this.cullFace);this.gl.renderer.setFrontFace(this.frontFace);this.gl.renderer.setDepthMask(this.depthWrite);this.gl.renderer.setDepthFunc(this.depthFunc);if(this.blendFunc.src)this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha);this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha);if(this.stencilFunc.func||this.stencilOp.stencilFail)this.gl.renderer.enable(this.gl.STENCIL_TEST);else this.gl.renderer.disable(this.gl.STENCIL_TEST);this.gl.renderer.setStencilFunc(this.stencilFunc.func,this.stencilFunc.ref,this.stencilFunc.mask);this.gl.renderer.setStencilOp(this.stencilOp.stencilFail,this.stencilOp.depthFail,this.stencilOp.depthPass)}use({flipFaces:t=false}={}){let e=-1;const i=this.gl.renderer.state.currentProgram===this.id;if(!i){this.gl.useProgram(this.program);this.gl.renderer.state.currentProgram=this.id}this.uniformLocations.forEach(((t,i)=>{let s=this.uniforms[i.uniformName];for(const t of i.nameComponents){if(!s)break;if(t in s){s=s[t]}else if(Array.isArray(s.value)){break}else{s=undefined;break}}if(!s){return $(`Active uniform ${i.name} has not been supplied`)}if(s&&s.value===undefined){return $(`${i.name} uniform is missing a value parameter`)}if(s.value.texture){e=e+1;s.value.update(e);return P(this.gl,i.type,t,e)}if(s.value.length&&s.value[0].texture){const n=[];s.value.forEach((t=>{e=e+1;t.update(e);n.push(e)}));return P(this.gl,i.type,t,n)}P(this.gl,i.type,t,s.value)}));this.applyState();if(t)this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function P(t,e,i,s){s=s.length?N(s):s;const n=t.renderer.state.uniformLocations.get(i);if(s.length){if(n===undefined||n.length!==s.length){t.renderer.state.uniformLocations.set(i,s.slice(0))}else{if(W(n,s))return;n.set?n.set(s):Y(n,s);t.renderer.state.uniformLocations.set(i,n)}}else{if(n===s)return;t.renderer.state.uniformLocations.set(i,s)}switch(e){case 5126:return s.length?t.uniform1fv(i,s):t.uniform1f(i,s);case 35664:return t.uniform2fv(i,s);case 35665:return t.uniform3fv(i,s);case 35666:return t.uniform4fv(i,s);case 35670:case 5124:case 35678:case 36306:case 35680:case 36289:return s.length?t.uniform1iv(i,s):t.uniform1i(i,s);case 35671:case 35667:return t.uniform2iv(i,s);case 35672:case 35668:return t.uniform3iv(i,s);case 35673:case 35669:return t.uniform4iv(i,s);case 35674:return t.uniformMatrix2fv(i,false,s);case 35675:return t.uniformMatrix3fv(i,false,s);case 35676:return t.uniformMatrix4fv(i,false,s)}}function G(t){let e=t.split("\n");for(let t=0;t<e.length;t++){e[t]=t+1+": "+e[t]}return e.join("\n")}function N(t){const e=t.length;const i=t[0].length;if(i===undefined)return t;const s=e*i;let n=L[s];if(!n)L[s]=n=new Float32Array(s);for(let s=0;s<e;s++)n.set(t[s],s*i);return n}function W(t,e){if(t.length!==e.length)return false;for(let i=0,s=t.length;i<s;i++){if(t[i]!==e[i])return false}return true}function Y(t,e){for(let i=0,s=t.length;i<s;i++){t[i]=e[i]}}let Z=0;function $(t){if(Z>100)return;console.warn(t);Z++;if(Z>100)console.warn("More than 100 program warnings - stopping logs.")}const j=new O;let U=1;class D{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:s=1,alpha:n=false,depth:r=true,stencil:h=false,antialias:o=false,premultipliedAlpha:l=false,preserveDrawingBuffer:a=false,powerPreference:u="default",autoClear:c=true,webgl:f=2}={}){const d={alpha:n,depth:r,stencil:h,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:a,powerPreference:u};this.dpr=s;this.alpha=n;this.color=true;this.depth=r;this.stencil=h;this.premultipliedAlpha=l;this.autoClear=c;this.id=U++;if(f===2)this.gl=t.getContext("webgl2",d);this.isWebgl2=!!this.gl;if(!this.gl)this.gl=t.getContext("webgl",d);if(!this.gl)console.error("unable to create webgl context");this.gl.renderer=this;this.setSize(e,i);this.state={};this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO};this.state.blendEquation={modeRGB:this.gl.FUNC_ADD};this.state.cullFace=false;this.state.frontFace=this.gl.CCW;this.state.depthMask=true;this.state.depthFunc=this.gl.LEQUAL;this.state.premultiplyAlpha=false;this.state.flipY=false;this.state.unpackAlignment=4;this.state.framebuffer=null;this.state.viewport={x:0,y:0,width:null,height:null};this.state.textureUnits=[];this.state.activeTextureUnit=0;this.state.boundBuffer=null;this.state.uniformLocations=new Map;this.state.currentProgram=null;this.extensions={};if(this.isWebgl2){this.getExtension("EXT_color_buffer_float");this.getExtension("OES_texture_float_linear")}else{this.getExtension("OES_texture_float");this.getExtension("OES_texture_float_linear");this.getExtension("OES_texture_half_float");this.getExtension("OES_texture_half_float_linear");this.getExtension("OES_element_index_uint");this.getExtension("OES_standard_derivatives");this.getExtension("EXT_sRGB");this.getExtension("WEBGL_depth_texture");this.getExtension("WEBGL_draw_buffers")}this.getExtension("WEBGL_compressed_texture_astc");this.getExtension("EXT_texture_compression_bptc");this.getExtension("WEBGL_compressed_texture_s3tc");this.getExtension("WEBGL_compressed_texture_etc1");this.getExtension("WEBGL_compressed_texture_pvrtc");this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE");this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE");this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE");this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES");this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES");this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES");this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL");this.parameters={};this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t;this.height=e;this.gl.canvas.width=t*this.dpr;this.gl.canvas.height=e*this.dpr;if(!this.gl.canvas.style)return;Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e,i=0,s=0){if(this.state.viewport.width===t&&this.state.viewport.height===e)return;this.state.viewport.width=t;this.state.viewport.height=e;this.state.viewport.x=i;this.state.viewport.y=s;this.gl.viewport(i,s,t,e)}setScissor(t,e,i=0,s=0){this.gl.scissor(i,s,t,e)}enable(t){if(this.state[t]===true)return;this.gl.enable(t);this.state[t]=true}disable(t){if(this.state[t]===false)return;this.gl.disable(t);this.state[t]=false}setBlendFunc(t,e,i,s){if(this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===s)return;this.state.blendFunc.src=t;this.state.blendFunc.dst=e;this.state.blendFunc.srcAlpha=i;this.state.blendFunc.dstAlpha=s;if(i!==undefined)this.gl.blendFuncSeparate(t,e,i,s);else this.gl.blendFunc(t,e)}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD;if(this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e)return;this.state.blendEquation.modeRGB=t;this.state.blendEquation.modeAlpha=e;if(e!==undefined)this.gl.blendEquationSeparate(t,e);else this.gl.blendEquation(t)}setCullFace(t){if(this.state.cullFace===t)return;this.state.cullFace=t;this.gl.cullFace(t)}setFrontFace(t){if(this.state.frontFace===t)return;this.state.frontFace=t;this.gl.frontFace(t)}setDepthMask(t){if(this.state.depthMask===t)return;this.state.depthMask=t;this.gl.depthMask(t)}setDepthFunc(t){if(this.state.depthFunc===t)return;this.state.depthFunc=t;this.gl.depthFunc(t)}setStencilMask(t){if(this.state.stencilMask===t)return;this.state.stencilMask=t;this.gl.stencilMask(t)}setStencilFunc(t,e,i){if(this.state.stencilFunc===t&&this.state.stencilRef===e&&this.state.stencilFuncMask===i)return;this.state.stencilFunc=t||this.gl.ALWAYS;this.state.stencilRef=e||0;this.state.stencilFuncMask=i||0;this.gl.stencilFunc(t||this.gl.ALWAYS,e||0,i||0)}setStencilOp(t,e,i){if(this.state.stencilFail===t&&this.state.stencilDepthFail===e&&this.state.stencilDepthPass===i)return;this.state.stencilFail=t;this.state.stencilDepthFail=e;this.state.stencilDepthPass=i;this.gl.stencilOp(t,e,i)}activeTexture(t){if(this.state.activeTextureUnit===t)return;this.state.activeTextureUnit=t;this.gl.activeTexture(this.gl.TEXTURE0+t)}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){if(this.state.framebuffer===e)return;this.state.framebuffer=e;this.gl.bindFramebuffer(t,e)}getExtension(t,e,i){if(e&&this.gl[e])return this.gl[e].bind(this.gl);if(!this.extensions[t]){this.extensions[t]=this.gl.getExtension(t)}if(!e)return this.extensions[t];if(!this.extensions[t])return null;return this.extensions[t][i].bind(this.extensions[t])}sortOpaque(t,e){if(t.renderOrder!==e.renderOrder){return t.renderOrder-e.renderOrder}else if(t.program.id!==e.program.id){return t.program.id-e.program.id}else if(t.zDepth!==e.zDepth){return t.zDepth-e.zDepth}else{return e.id-t.id}}sortTransparent(t,e){if(t.renderOrder!==e.renderOrder){return t.renderOrder-e.renderOrder}if(t.zDepth!==e.zDepth){return e.zDepth-t.zDepth}else{return e.id-t.id}}sortUI(t,e){if(t.renderOrder!==e.renderOrder){return t.renderOrder-e.renderOrder}else if(t.program.id!==e.program.id){return t.program.id-e.program.id}else{return e.id-t.id}}getRenderList({scene:t,camera:e,frustumCull:i,sort:s}){let n=[];if(e&&i)e.updateFrustum();t.traverse((t=>{if(!t.visible)return true;if(!t.draw)return;if(i&&t.frustumCulled&&e){if(!e.frustumIntersectsMesh(t))return}n.push(t)}));if(s){const t=[];const i=[];const s=[];n.forEach((n=>{if(!n.program.transparent){t.push(n)}else if(n.program.depthTest){i.push(n)}else{s.push(n)}n.zDepth=0;if(n.renderOrder!==0||!n.program.depthTest||!e)return;n.worldMatrix.getTranslation(j);j.applyMatrix4(e.projectionViewMatrix);n.zDepth=j.z}));t.sort(this.sortOpaque);i.sort(this.sortTransparent);s.sort(this.sortUI);n=t.concat(i,s)}return n}render({scene:t,camera:e,target:i=null,update:s=true,sort:n=true,frustumCull:r=true,clear:h}){if(i===null){this.bindFramebuffer();this.setViewport(this.width*this.dpr,this.height*this.dpr)}else{this.bindFramebuffer(i);this.setViewport(i.width,i.height)}if(h||this.autoClear&&h!==false){if(this.depth&&(!i||i.depth)){this.enable(this.gl.DEPTH_TEST);this.setDepthMask(true)}if(this.stencil||(!i||i.stencil)){this.enable(this.gl.STENCIL_TEST);this.setStencilMask(255)}this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))}if(s)t.updateMatrixWorld();if(e)e.updateMatrixWorld();const o=this.getRenderList({scene:t,camera:e,frustumCull:r,sort:n});o.forEach((t=>{t.draw({camera:e})}))}}function V(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function Q(t,e,i,s,n){t[0]=e;t[1]=i;t[2]=s;t[3]=n;return t}function H(t,e){let i=e[0];let s=e[1];let n=e[2];let r=e[3];let h=i*i+s*s+n*n+r*r;if(h>0){h=1/Math.sqrt(h)}t[0]=i*h;t[1]=s*h;t[2]=n*h;t[3]=r*h;return t}function K(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function J(t){t[0]=0;t[1]=0;t[2]=0;t[3]=1;return t}function tt(t,e,i){i=i*.5;let s=Math.sin(i);t[0]=s*e[0];t[1]=s*e[1];t[2]=s*e[2];t[3]=Math.cos(i);return t}function et(t,e,i){let s=e[0],n=e[1],r=e[2],h=e[3];let o=i[0],l=i[1],a=i[2],u=i[3];t[0]=s*u+h*o+n*a-r*l;t[1]=n*u+h*l+r*o-s*a;t[2]=r*u+h*a+s*l-n*o;t[3]=h*u-s*o-n*l-r*a;return t}function it(t,e,i){i*=.5;let s=e[0],n=e[1],r=e[2],h=e[3];let o=Math.sin(i),l=Math.cos(i);t[0]=s*l+h*o;t[1]=n*l+r*o;t[2]=r*l-n*o;t[3]=h*l-s*o;return t}function st(t,e,i){i*=.5;let s=e[0],n=e[1],r=e[2],h=e[3];let o=Math.sin(i),l=Math.cos(i);t[0]=s*l-r*o;t[1]=n*l+h*o;t[2]=r*l+s*o;t[3]=h*l-n*o;return t}function nt(t,e,i){i*=.5;let s=e[0],n=e[1],r=e[2],h=e[3];let o=Math.sin(i),l=Math.cos(i);t[0]=s*l+n*o;t[1]=n*l-s*o;t[2]=r*l+h*o;t[3]=h*l-r*o;return t}function rt(t,e,i,s){let n=e[0],r=e[1],h=e[2],o=e[3];let l=i[0],a=i[1],u=i[2],c=i[3];let f,d,p,m,x;d=n*l+r*a+h*u+o*c;if(d<0){d=-d;l=-l;a=-a;u=-u;c=-c}if(1-d>1e-6){f=Math.acos(d);p=Math.sin(f);m=Math.sin((1-s)*f)/p;x=Math.sin(s*f)/p}else{m=1-s;x=s}t[0]=m*n+x*l;t[1]=m*r+x*a;t[2]=m*h+x*u;t[3]=m*o+x*c;return t}function ht(t,e){let i=e[0],s=e[1],n=e[2],r=e[3];let h=i*i+s*s+n*n+r*r;let o=h?1/h:0;t[0]=-i*o;t[1]=-s*o;t[2]=-n*o;t[3]=r*o;return t}function ot(t,e){t[0]=-e[0];t[1]=-e[1];t[2]=-e[2];t[3]=e[3];return t}function lt(t,e){let i=e[0]+e[4]+e[8];let s;if(i>0){s=Math.sqrt(i+1);t[3]=.5*s;s=.5/s;t[0]=(e[5]-e[7])*s;t[1]=(e[6]-e[2])*s;t[2]=(e[1]-e[3])*s}else{let i=0;if(e[4]>e[0])i=1;if(e[8]>e[i*3+i])i=2;let n=(i+1)%3;let r=(i+2)%3;s=Math.sqrt(e[i*3+i]-e[n*3+n]-e[r*3+r]+1);t[i]=.5*s;s=.5/s;t[3]=(e[n*3+r]-e[r*3+n])*s;t[n]=(e[n*3+i]+e[i*3+n])*s;t[r]=(e[r*3+i]+e[i*3+r])*s}return t}function at(t,e,i="YXZ"){let s=Math.sin(e[0]*.5);let n=Math.cos(e[0]*.5);let r=Math.sin(e[1]*.5);let h=Math.cos(e[1]*.5);let o=Math.sin(e[2]*.5);let l=Math.cos(e[2]*.5);if(i==="XYZ"){t[0]=s*h*l+n*r*o;t[1]=n*r*l-s*h*o;t[2]=n*h*o+s*r*l;t[3]=n*h*l-s*r*o}else if(i==="YXZ"){t[0]=s*h*l+n*r*o;t[1]=n*r*l-s*h*o;t[2]=n*h*o-s*r*l;t[3]=n*h*l+s*r*o}else if(i==="ZXY"){t[0]=s*h*l-n*r*o;t[1]=n*r*l+s*h*o;t[2]=n*h*o+s*r*l;t[3]=n*h*l-s*r*o}else if(i==="ZYX"){t[0]=s*h*l-n*r*o;t[1]=n*r*l+s*h*o;t[2]=n*h*o-s*r*l;t[3]=n*h*l+s*r*o}else if(i==="YZX"){t[0]=s*h*l+n*r*o;t[1]=n*r*l+s*h*o;t[2]=n*h*o-s*r*l;t[3]=n*h*l-s*r*o}else if(i==="XZY"){t[0]=s*h*l-n*r*o;t[1]=n*r*l-s*h*o;t[2]=n*h*o+s*r*l;t[3]=n*h*l+s*r*o}return t}const ut=V;const ct=Q;const ft=K;const dt=H;class pt extends Array{constructor(t=0,e=0,i=0,s=1){super(t,e,i,s);this.onChange=()=>{};this._target=this;const n=["0","1","2","3"];return new Proxy(this,{set(t,e){const i=Reflect.set(...arguments);if(i&&n.includes(e))t.onChange();return i}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this._target[0]=t;this.onChange()}set y(t){this._target[1]=t;this.onChange()}set z(t){this._target[2]=t;this.onChange()}set w(t){this._target[3]=t;this.onChange()}identity(){J(this._target);this.onChange();return this}set(t,e,i,s){if(t.length)return this.copy(t);ct(this._target,t,e,i,s);this.onChange();return this}rotateX(t){it(this._target,this._target,t);this.onChange();return this}rotateY(t){st(this._target,this._target,t);this.onChange();return this}rotateZ(t){nt(this._target,this._target,t);this.onChange();return this}inverse(t=this._target){ht(this._target,t);this.onChange();return this}conjugate(t=this._target){ot(this._target,t);this.onChange();return this}copy(t){ut(this._target,t);this.onChange();return this}normalize(t=this._target){dt(this._target,t);this.onChange();return this}multiply(t,e){if(e){et(this._target,t,e)}else{et(this._target,this._target,t)}this.onChange();return this}dot(t){return ft(this._target,t)}fromMatrix3(t){lt(this._target,t);this.onChange();return this}fromEuler(t,e){at(this._target,t,t.order);if(!e)this.onChange();return this}fromAxisAngle(t,e){tt(this._target,t,e);this.onChange();return this}slerp(t,e){rt(this._target,this._target,t,e);this.onChange();return this}fromArray(t,e=0){this._target[0]=t[e];this._target[1]=t[e+1];this._target[2]=t[e+2];this._target[3]=t[e+3];this.onChange();return this}toArray(t=[],e=0){t[e]=this[0];t[e+1]=this[1];t[e+2]=this[2];t[e+3]=this[3];return t}}const mt=1e-6;function xt(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function gt(t,e,i,s,n,r,h,o,l,a,u,c,f,d,p,m,x){t[0]=e;t[1]=i;t[2]=s;t[3]=n;t[4]=r;t[5]=h;t[6]=o;t[7]=l;t[8]=a;t[9]=u;t[10]=c;t[11]=f;t[12]=d;t[13]=p;t[14]=m;t[15]=x;return t}function yt(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=1;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t}function bt(t,e){let i=e[0],s=e[1],n=e[2],r=e[3];let h=e[4],o=e[5],l=e[6],a=e[7];let u=e[8],c=e[9],f=e[10],d=e[11];let p=e[12],m=e[13],x=e[14],g=e[15];let y=i*o-s*h;let b=i*l-n*h;let v=i*a-r*h;let w=s*l-n*o;let M=s*a-r*o;let _=n*a-r*l;let C=u*m-c*p;let A=u*x-f*p;let q=u*g-d*p;let E=c*x-f*m;let k=c*g-d*m;let S=f*g-d*x;let O=y*S-b*k+v*E+w*q-M*A+_*C;if(!O){return null}O=1/O;t[0]=(o*S-l*k+a*E)*O;t[1]=(n*k-s*S-r*E)*O;t[2]=(m*_-x*M+g*w)*O;t[3]=(f*M-c*_-d*w)*O;t[4]=(l*q-h*S-a*A)*O;t[5]=(i*S-n*q+r*A)*O;t[6]=(x*v-p*_-g*b)*O;t[7]=(u*_-f*v+d*b)*O;t[8]=(h*k-o*q+a*C)*O;t[9]=(s*q-i*k-r*C)*O;t[10]=(p*M-m*v+g*y)*O;t[11]=(c*v-u*M-d*y)*O;t[12]=(o*A-h*E-l*C)*O;t[13]=(i*E-s*A+n*C)*O;t[14]=(m*b-p*w-x*y)*O;t[15]=(u*w-c*b+f*y)*O;return t}function vt(t){let e=t[0],i=t[1],s=t[2],n=t[3];let r=t[4],h=t[5],o=t[6],l=t[7];let a=t[8],u=t[9],c=t[10],f=t[11];let d=t[12],p=t[13],m=t[14],x=t[15];let g=e*h-i*r;let y=e*o-s*r;let b=e*l-n*r;let v=i*o-s*h;let w=i*l-n*h;let M=s*l-n*o;let _=a*p-u*d;let C=a*m-c*d;let A=a*x-f*d;let q=u*m-c*p;let E=u*x-f*p;let k=c*x-f*m;return g*k-y*E+b*q+v*A-w*C+M*_}function wt(t,e,i){let s=e[0],n=e[1],r=e[2],h=e[3];let o=e[4],l=e[5],a=e[6],u=e[7];let c=e[8],f=e[9],d=e[10],p=e[11];let m=e[12],x=e[13],g=e[14],y=e[15];let b=i[0],v=i[1],w=i[2],M=i[3];t[0]=b*s+v*o+w*c+M*m;t[1]=b*n+v*l+w*f+M*x;t[2]=b*r+v*a+w*d+M*g;t[3]=b*h+v*u+w*p+M*y;b=i[4];v=i[5];w=i[6];M=i[7];t[4]=b*s+v*o+w*c+M*m;t[5]=b*n+v*l+w*f+M*x;t[6]=b*r+v*a+w*d+M*g;t[7]=b*h+v*u+w*p+M*y;b=i[8];v=i[9];w=i[10];M=i[11];t[8]=b*s+v*o+w*c+M*m;t[9]=b*n+v*l+w*f+M*x;t[10]=b*r+v*a+w*d+M*g;t[11]=b*h+v*u+w*p+M*y;b=i[12];v=i[13];w=i[14];M=i[15];t[12]=b*s+v*o+w*c+M*m;t[13]=b*n+v*l+w*f+M*x;t[14]=b*r+v*a+w*d+M*g;t[15]=b*h+v*u+w*p+M*y;return t}function Mt(t,e,i){let s=i[0],n=i[1],r=i[2];let h,o,l,a;let u,c,f,d;let p,m,x,g;if(e===t){t[12]=e[0]*s+e[4]*n+e[8]*r+e[12];t[13]=e[1]*s+e[5]*n+e[9]*r+e[13];t[14]=e[2]*s+e[6]*n+e[10]*r+e[14];t[15]=e[3]*s+e[7]*n+e[11]*r+e[15]}else{h=e[0];o=e[1];l=e[2];a=e[3];u=e[4];c=e[5];f=e[6];d=e[7];p=e[8];m=e[9];x=e[10];g=e[11];t[0]=h;t[1]=o;t[2]=l;t[3]=a;t[4]=u;t[5]=c;t[6]=f;t[7]=d;t[8]=p;t[9]=m;t[10]=x;t[11]=g;t[12]=h*s+u*n+p*r+e[12];t[13]=o*s+c*n+m*r+e[13];t[14]=l*s+f*n+x*r+e[14];t[15]=a*s+d*n+g*r+e[15]}return t}function _t(t,e,i){let s=i[0],n=i[1],r=i[2];t[0]=e[0]*s;t[1]=e[1]*s;t[2]=e[2]*s;t[3]=e[3]*s;t[4]=e[4]*n;t[5]=e[5]*n;t[6]=e[6]*n;t[7]=e[7]*n;t[8]=e[8]*r;t[9]=e[9]*r;t[10]=e[10]*r;t[11]=e[11]*r;t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function Ct(t,e,i,s){let n=s[0],r=s[1],h=s[2];let o=Math.hypot(n,r,h);let l,a,u;let c,f,d,p;let m,x,g,y;let b,v,w,M;let _,C,A;let q,E,k;let S,O,z;if(Math.abs(o)<mt){return null}o=1/o;n*=o;r*=o;h*=o;l=Math.sin(i);a=Math.cos(i);u=1-a;c=e[0];f=e[1];d=e[2];p=e[3];m=e[4];x=e[5];g=e[6];y=e[7];b=e[8];v=e[9];w=e[10];M=e[11];_=n*n*u+a;C=r*n*u+h*l;A=h*n*u-r*l;q=n*r*u-h*l;E=r*r*u+a;k=h*r*u+n*l;S=n*h*u+r*l;O=r*h*u-n*l;z=h*h*u+a;t[0]=c*_+m*C+b*A;t[1]=f*_+x*C+v*A;t[2]=d*_+g*C+w*A;t[3]=p*_+y*C+M*A;t[4]=c*q+m*E+b*k;t[5]=f*q+x*E+v*k;t[6]=d*q+g*E+w*k;t[7]=p*q+y*E+M*k;t[8]=c*S+m*O+b*z;t[9]=f*S+x*O+v*z;t[10]=d*S+g*O+w*z;t[11]=p*S+y*O+M*z;if(e!==t){t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15]}return t}function At(t,e){t[0]=e[12];t[1]=e[13];t[2]=e[14];return t}function qt(t,e){let i=e[0];let s=e[1];let n=e[2];let r=e[4];let h=e[5];let o=e[6];let l=e[8];let a=e[9];let u=e[10];t[0]=Math.hypot(i,s,n);t[1]=Math.hypot(r,h,o);t[2]=Math.hypot(l,a,u);return t}function Et(t){let e=t[0];let i=t[1];let s=t[2];let n=t[4];let r=t[5];let h=t[6];let o=t[8];let l=t[9];let a=t[10];const u=e*e+i*i+s*s;const c=n*n+r*r+h*h;const f=o*o+l*l+a*a;return Math.sqrt(Math.max(u,c,f))}const kt=function(){const t=[1,1,1];return function(e,i){let s=t;qt(s,i);let n=1/s[0];let r=1/s[1];let h=1/s[2];let o=i[0]*n;let l=i[1]*r;let a=i[2]*h;let u=i[4]*n;let c=i[5]*r;let f=i[6]*h;let d=i[8]*n;let p=i[9]*r;let m=i[10]*h;let x=o+c+m;let g=0;if(x>0){g=Math.sqrt(x+1)*2;e[3]=.25*g;e[0]=(f-p)/g;e[1]=(d-a)/g;e[2]=(l-u)/g}else if(o>c&&o>m){g=Math.sqrt(1+o-c-m)*2;e[3]=(f-p)/g;e[0]=.25*g;e[1]=(l+u)/g;e[2]=(d+a)/g}else if(c>m){g=Math.sqrt(1+c-o-m)*2;e[3]=(d-a)/g;e[0]=(l+u)/g;e[1]=.25*g;e[2]=(f+p)/g}else{g=Math.sqrt(1+m-o-c)*2;e[3]=(l-u)/g;e[0]=(d+a)/g;e[1]=(f+p)/g;e[2]=.25*g}return e}}();function St(t,e,i,s){let n=h([t[0],t[1],t[2]]);const r=h([t[4],t[5],t[6]]);const o=h([t[8],t[9],t[10]]);const l=vt(t);if(l<0)n=-n;i[0]=t[12];i[1]=t[13];i[2]=t[14];const a=t.slice();const u=1/n;const c=1/r;const f=1/o;a[0]*=u;a[1]*=u;a[2]*=u;a[4]*=c;a[5]*=c;a[6]*=c;a[8]*=f;a[9]*=f;a[10]*=f;kt(e,a);s[0]=n;s[1]=r;s[2]=o}function Ot(t,e,i,s){const n=t;const r=e[0],h=e[1],o=e[2],l=e[3];const a=r+r,u=h+h,c=o+o;const f=r*a,d=r*u,p=r*c;const m=h*u,x=h*c,g=o*c;const y=l*a,b=l*u,v=l*c;const w=s[0],M=s[1],_=s[2];n[0]=(1-(m+g))*w;n[1]=(d+v)*w;n[2]=(p-b)*w;n[3]=0;n[4]=(d-v)*M;n[5]=(1-(f+g))*M;n[6]=(x+y)*M;n[7]=0;n[8]=(p+b)*_;n[9]=(x-y)*_;n[10]=(1-(f+m))*_;n[11]=0;n[12]=i[0];n[13]=i[1];n[14]=i[2];n[15]=1;return n}function zt(t,e){let i=e[0],s=e[1],n=e[2],r=e[3];let h=i+i;let o=s+s;let l=n+n;let a=i*h;let u=s*h;let c=s*o;let f=n*h;let d=n*o;let p=n*l;let m=r*h;let x=r*o;let g=r*l;t[0]=1-c-p;t[1]=u+g;t[2]=f-x;t[3]=0;t[4]=u-g;t[5]=1-a-p;t[6]=d+m;t[7]=0;t[8]=f+x;t[9]=d-m;t[10]=1-a-c;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t}function Bt(t,e,i,s,n){let r=1/Math.tan(e/2);let h=1/(s-n);t[0]=r/i;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=r;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=(n+s)*h;t[11]=-1;t[12]=0;t[13]=0;t[14]=2*n*s*h;t[15]=0;return t}function Ft(t,e,i,s,n,r,h){let o=1/(e-i);let l=1/(s-n);let a=1/(r-h);t[0]=-2*o;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=-2*l;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=2*a;t[11]=0;t[12]=(e+i)*o;t[13]=(n+s)*l;t[14]=(h+r)*a;t[15]=1;return t}function Tt(t,e,i,s){let n=e[0],r=e[1],h=e[2],o=s[0],l=s[1],a=s[2];let u=n-i[0],c=r-i[1],f=h-i[2];let d=u*u+c*c+f*f;if(d===0){f=1}else{d=1/Math.sqrt(d);u*=d;c*=d;f*=d}let p=l*f-a*c,m=a*u-o*f,x=o*c-l*u;d=p*p+m*m+x*x;if(d===0){if(a){o+=1e-6}else if(l){a+=1e-6}else{l+=1e-6}p=l*f-a*c,m=a*u-o*f,x=o*c-l*u;d=p*p+m*m+x*x}d=1/Math.sqrt(d);p*=d;m*=d;x*=d;t[0]=p;t[1]=m;t[2]=x;t[3]=0;t[4]=c*x-f*m;t[5]=f*p-u*x;t[6]=u*m-c*p;t[7]=0;t[8]=u;t[9]=c;t[10]=f;t[11]=0;t[12]=n;t[13]=r;t[14]=h;t[15]=1;return t}function Rt(t,e,i){t[0]=e[0]+i[0];t[1]=e[1]+i[1];t[2]=e[2]+i[2];t[3]=e[3]+i[3];t[4]=e[4]+i[4];t[5]=e[5]+i[5];t[6]=e[6]+i[6];t[7]=e[7]+i[7];t[8]=e[8]+i[8];t[9]=e[9]+i[9];t[10]=e[10]+i[10];t[11]=e[11]+i[11];t[12]=e[12]+i[12];t[13]=e[13]+i[13];t[14]=e[14]+i[14];t[15]=e[15]+i[15];return t}function It(t,e,i){t[0]=e[0]-i[0];t[1]=e[1]-i[1];t[2]=e[2]-i[2];t[3]=e[3]-i[3];t[4]=e[4]-i[4];t[5]=e[5]-i[5];t[6]=e[6]-i[6];t[7]=e[7]-i[7];t[8]=e[8]-i[8];t[9]=e[9]-i[9];t[10]=e[10]-i[10];t[11]=e[11]-i[11];t[12]=e[12]-i[12];t[13]=e[13]-i[13];t[14]=e[14]-i[14];t[15]=e[15]-i[15];return t}function Lt(t,e,i){t[0]=e[0]*i;t[1]=e[1]*i;t[2]=e[2]*i;t[3]=e[3]*i;t[4]=e[4]*i;t[5]=e[5]*i;t[6]=e[6]*i;t[7]=e[7]*i;t[8]=e[8]*i;t[9]=e[9]*i;t[10]=e[10]*i;t[11]=e[11]*i;t[12]=e[12]*i;t[13]=e[13]*i;t[14]=e[14]*i;t[15]=e[15]*i;return t}class Xt extends Array{constructor(t=1,e=0,i=0,s=0,n=0,r=1,h=0,o=0,l=0,a=0,u=1,c=0,f=0,d=0,p=0,m=1){super(t,e,i,s,n,r,h,o,l,a,u,c,f,d,p,m);return this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,i,s,n,r,h,o,l,a,u,c,f,d,p,m){if(t.length)return this.copy(t);gt(this,t,e,i,s,n,r,h,o,l,a,u,c,f,d,p,m);return this}translate(t,e=this){Mt(this,e,t);return this}rotate(t,e,i=this){Ct(this,i,t,e);return this}scale(t,e=this){_t(this,e,typeof t==="number"?[t,t,t]:t);return this}add(t,e){if(e)Rt(this,t,e);else Rt(this,this,t);return this}sub(t,e){if(e)It(this,t,e);else It(this,this,t);return this}multiply(t,e){if(!t.length){Lt(this,this,t)}else if(e){wt(this,t,e)}else{wt(this,this,t)}return this}identity(){yt(this);return this}copy(t){xt(this,t);return this}fromPerspective({fov:t,aspect:e,near:i,far:s}={}){Bt(this,t,e,i,s);return this}fromOrthogonal({left:t,right:e,bottom:i,top:s,near:n,far:r}){Ft(this,t,e,i,s,n,r);return this}fromQuaternion(t){zt(this,t);return this}setPosition(t){this.x=t[0];this.y=t[1];this.z=t[2];return this}inverse(t=this){bt(this,t);return this}compose(t,e,i){Ot(this,t,e,i);return this}decompose(t,e,i){St(this,t,e,i);return this}getRotation(t){kt(t,this);return this}getTranslation(t){At(t,this);return this}getScaling(t){qt(t,this);return this}getMaxScaleOnAxis(){return Et(this)}lookAt(t,e,i){Tt(this,t,e,i);return this}determinant(){return vt(this)}fromArray(t,e=0){this[0]=t[e];this[1]=t[e+1];this[2]=t[e+2];this[3]=t[e+3];this[4]=t[e+4];this[5]=t[e+5];this[6]=t[e+6];this[7]=t[e+7];this[8]=t[e+8];this[9]=t[e+9];this[10]=t[e+10];this[11]=t[e+11];this[12]=t[e+12];this[13]=t[e+13];this[14]=t[e+14];this[15]=t[e+15];return this}toArray(t=[],e=0){t[e]=this[0];t[e+1]=this[1];t[e+2]=this[2];t[e+3]=this[3];t[e+4]=this[4];t[e+5]=this[5];t[e+6]=this[6];t[e+7]=this[7];t[e+8]=this[8];t[e+9]=this[9];t[e+10]=this[10];t[e+11]=this[11];t[e+12]=this[12];t[e+13]=this[13];t[e+14]=this[14];t[e+15]=this[15];return t}}function Pt(t,e,i="YXZ"){if(i==="XYZ"){t[1]=Math.asin(Math.min(Math.max(e[8],-1),1));if(Math.abs(e[8])<.99999){t[0]=Math.atan2(-e[9],e[10]);t[2]=Math.atan2(-e[4],e[0])}else{t[0]=Math.atan2(e[6],e[5]);t[2]=0}}else if(i==="YXZ"){t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1));if(Math.abs(e[9])<.99999){t[1]=Math.atan2(e[8],e[10]);t[2]=Math.atan2(e[1],e[5])}else{t[1]=Math.atan2(-e[2],e[0]);t[2]=0}}else if(i==="ZXY"){t[0]=Math.asin(Math.min(Math.max(e[6],-1),1));if(Math.abs(e[6])<.99999){t[1]=Math.atan2(-e[2],e[10]);t[2]=Math.atan2(-e[4],e[5])}else{t[1]=0;t[2]=Math.atan2(e[1],e[0])}}else if(i==="ZYX"){t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1));if(Math.abs(e[2])<.99999){t[0]=Math.atan2(e[6],e[10]);t[2]=Math.atan2(e[1],e[0])}else{t[0]=0;t[2]=Math.atan2(-e[4],e[5])}}else if(i==="YZX"){t[2]=Math.asin(Math.min(Math.max(e[1],-1),1));if(Math.abs(e[1])<.99999){t[0]=Math.atan2(-e[9],e[5]);t[1]=Math.atan2(-e[2],e[0])}else{t[0]=0;t[1]=Math.atan2(e[8],e[10])}}else if(i==="XZY"){t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1));if(Math.abs(e[4])<.99999){t[0]=Math.atan2(e[6],e[5]);t[1]=Math.atan2(e[8],e[0])}else{t[0]=Math.atan2(-e[9],e[10]);t[1]=0}}return t}const Gt=new Xt;class Nt extends Array{constructor(t=0,e=t,i=t,s="YXZ"){super(t,e,i);this.order=s;this.onChange=()=>{};this._target=this;const n=["0","1","2"];return new Proxy(this,{set(t,e){const i=Reflect.set(...arguments);if(i&&n.includes(e))t.onChange();return i}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this._target[0]=t;this.onChange()}set y(t){this._target[1]=t;this.onChange()}set z(t){this._target[2]=t;this.onChange()}set(t,e=t,i=t){if(t.length)return this.copy(t);this._target[0]=t;this._target[1]=e;this._target[2]=i;this.onChange();return this}copy(t){this._target[0]=t[0];this._target[1]=t[1];this._target[2]=t[2];this.onChange();return this}reorder(t){this._target.order=t;this.onChange();return this}fromRotationMatrix(t,e=this.order){Pt(this._target,t,e);this.onChange();return this}fromQuaternion(t,e=this.order,i){Gt.fromQuaternion(t);this._target.fromRotationMatrix(Gt,e);if(!i)this.onChange();return this}fromArray(t,e=0){this._target[0]=t[e];this._target[1]=t[e+1];this._target[2]=t[e+2];return this}toArray(t=[],e=0){t[e]=this[0];t[e+1]=this[1];t[e+2]=this[2];return t}}class Wt{constructor(){this.parent=null;this.children=[];this.visible=true;this.matrix=new Xt;this.worldMatrix=new Xt;this.matrixAutoUpdate=true;this.worldMatrixNeedsUpdate=false;this.position=new O;this.quaternion=new pt;this.scale=new O(1);this.rotation=new Nt;this.up=new O(0,1,0);this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,true);this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,undefined,true)}setParent(t,e=true){if(this.parent&&t!==this.parent)this.parent.removeChild(this,false);this.parent=t;if(e&&t)t.addChild(this,false)}addChild(t,e=true){if(!~this.children.indexOf(t))this.children.push(t);if(e)t.setParent(this,false)}removeChild(t,e=true){if(!!~this.children.indexOf(t))this.children.splice(this.children.indexOf(t),1);if(e)t.setParent(null,false)}updateMatrixWorld(t){if(this.matrixAutoUpdate)this.updateMatrix();if(this.worldMatrixNeedsUpdate||t){if(this.parent===null)this.worldMatrix.copy(this.matrix);else this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix);this.worldMatrixNeedsUpdate=false;t=true}for(let e=0,i=this.children.length;e<i;e++){this.children[e].updateMatrixWorld(t)}}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale);this.worldMatrixNeedsUpdate=true}traverse(t){if(t(this))return;for(let e=0,i=this.children.length;e<i;e++){this.children[e].traverse(t)}}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale);this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=false){if(e)this.matrix.lookAt(this.position,t,this.up);else this.matrix.lookAt(t,this.position,this.up);this.matrix.getRotation(this.quaternion._target);this.rotation.fromQuaternion(this.quaternion)}}function Yt(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[4];t[4]=e[5];t[5]=e[6];t[6]=e[8];t[7]=e[9];t[8]=e[10];return t}function Zt(t,e){let i=e[0],s=e[1],n=e[2],r=e[3];let h=i+i;let o=s+s;let l=n+n;let a=i*h;let u=s*h;let c=s*o;let f=n*h;let d=n*o;let p=n*l;let m=r*h;let x=r*o;let g=r*l;t[0]=1-c-p;t[3]=u-g;t[6]=f+x;t[1]=u+g;t[4]=1-a-p;t[7]=d-m;t[2]=f-x;t[5]=d+m;t[8]=1-a-c;return t}function $t(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function jt(t,e,i,s,n,r,h,o,l,a){t[0]=e;t[1]=i;t[2]=s;t[3]=n;t[4]=r;t[5]=h;t[6]=o;t[7]=l;t[8]=a;return t}function Ut(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t}function Dt(t,e){let i=e[0],s=e[1],n=e[2];let r=e[3],h=e[4],o=e[5];let l=e[6],a=e[7],u=e[8];let c=u*h-o*a;let f=-u*r+o*l;let d=a*r-h*l;let p=i*c+s*f+n*d;if(!p){return null}p=1/p;t[0]=c*p;t[1]=(-u*s+n*a)*p;t[2]=(o*s-n*h)*p;t[3]=f*p;t[4]=(u*i-n*l)*p;t[5]=(-o*i+n*r)*p;t[6]=d*p;t[7]=(-a*i+s*l)*p;t[8]=(h*i-s*r)*p;return t}function Vt(t,e,i){let s=e[0],n=e[1],r=e[2];let h=e[3],o=e[4],l=e[5];let a=e[6],u=e[7],c=e[8];let f=i[0],d=i[1],p=i[2];let m=i[3],x=i[4],g=i[5];let y=i[6],b=i[7],v=i[8];t[0]=f*s+d*h+p*a;t[1]=f*n+d*o+p*u;t[2]=f*r+d*l+p*c;t[3]=m*s+x*h+g*a;t[4]=m*n+x*o+g*u;t[5]=m*r+x*l+g*c;t[6]=y*s+b*h+v*a;t[7]=y*n+b*o+v*u;t[8]=y*r+b*l+v*c;return t}function Qt(t,e,i){let s=e[0],n=e[1],r=e[2],h=e[3],o=e[4],l=e[5],a=e[6],u=e[7],c=e[8],f=i[0],d=i[1];t[0]=s;t[1]=n;t[2]=r;t[3]=h;t[4]=o;t[5]=l;t[6]=f*s+d*h+a;t[7]=f*n+d*o+u;t[8]=f*r+d*l+c;return t}function Ht(t,e,i){let s=e[0],n=e[1],r=e[2],h=e[3],o=e[4],l=e[5],a=e[6],u=e[7],c=e[8],f=Math.sin(i),d=Math.cos(i);t[0]=d*s+f*h;t[1]=d*n+f*o;t[2]=d*r+f*l;t[3]=d*h-f*s;t[4]=d*o-f*n;t[5]=d*l-f*r;t[6]=a;t[7]=u;t[8]=c;return t}function Kt(t,e,i){let s=i[0],n=i[1];t[0]=s*e[0];t[1]=s*e[1];t[2]=s*e[2];t[3]=n*e[3];t[4]=n*e[4];t[5]=n*e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Jt(t,e){let i=e[0],s=e[1],n=e[2],r=e[3];let h=e[4],o=e[5],l=e[6],a=e[7];let u=e[8],c=e[9],f=e[10],d=e[11];let p=e[12],m=e[13],x=e[14],g=e[15];let y=i*o-s*h;let b=i*l-n*h;let v=i*a-r*h;let w=s*l-n*o;let M=s*a-r*o;let _=n*a-r*l;let C=u*m-c*p;let A=u*x-f*p;let q=u*g-d*p;let E=c*x-f*m;let k=c*g-d*m;let S=f*g-d*x;let O=y*S-b*k+v*E+w*q-M*A+_*C;if(!O){return null}O=1/O;t[0]=(o*S-l*k+a*E)*O;t[1]=(l*q-h*S-a*A)*O;t[2]=(h*k-o*q+a*C)*O;t[3]=(n*k-s*S-r*E)*O;t[4]=(i*S-n*q+r*A)*O;t[5]=(s*q-i*k-r*C)*O;t[6]=(m*_-x*M+g*w)*O;t[7]=(x*v-p*_-g*b)*O;t[8]=(p*M-m*v+g*y)*O;return t}class te extends Array{constructor(t=1,e=0,i=0,s=0,n=1,r=0,h=0,o=0,l=1){super(t,e,i,s,n,r,h,o,l);return this}set(t,e,i,s,n,r,h,o,l){if(t.length)return this.copy(t);jt(this,t,e,i,s,n,r,h,o,l);return this}translate(t,e=this){Qt(this,e,t);return this}rotate(t,e=this){Ht(this,e,t);return this}scale(t,e=this){Kt(this,e,t);return this}multiply(t,e){if(e){Vt(this,t,e)}else{Vt(this,this,t)}return this}identity(){Ut(this);return this}copy(t){$t(this,t);return this}fromMatrix4(t){Yt(this,t);return this}fromQuaternion(t){Zt(this,t);return this}fromBasis(t,e,i){this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]);return this}inverse(t=this){Dt(this,t);return this}getNormalMatrix(t){Jt(this,t);return this}}let ee=0;class ie extends Wt{constructor(t,{geometry:e,program:i,mode:s=t.TRIANGLES,frustumCulled:n=true,renderOrder:r=0}={}){super();if(!t.canvas)console.error("gl not passed as first argument to Mesh");this.gl=t;this.id=ee++;this.geometry=e;this.program=i;this.mode=s;this.frustumCulled=n;this.renderOrder=r;this.modelViewMatrix=new Xt;this.normalMatrix=new te;this.beforeRenderCallbacks=[];this.afterRenderCallbacks=[]}onBeforeRender(t){this.beforeRenderCallbacks.push(t);return this}onAfterRender(t){this.afterRenderCallbacks.push(t);return this}draw({camera:t}={}){if(t){if(!this.program.uniforms.modelMatrix){Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}})}this.program.uniforms.projectionMatrix.value=t.projectionMatrix;this.program.uniforms.cameraPosition.value=t.worldPosition;this.program.uniforms.viewMatrix.value=t.viewMatrix;this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix);this.normalMatrix.getNormalMatrix(this.modelViewMatrix);this.program.uniforms.modelMatrix.value=this.worldMatrix;this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix;this.program.uniforms.normalMatrix.value=this.normalMatrix}this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})));let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e});this.geometry.draw({mode:this.mode,program:this.program});this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}const se={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function ne(t){if(t.length===4)t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3];const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!e)console.warn(`Unable to convert hex string ${t} to rgb values`);return[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}function re(t){t=parseInt(t);return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function he(t){if(t===undefined)return[0,0,0];if(arguments.length===3)return arguments;if(!isNaN(t))return re(t);if(t[0]==="#")return ne(t);if(se[t.toLowerCase()])return ne(se[t.toLowerCase()]);console.warn("Color format not recognised");return[0,0,0]}class oe extends Array{constructor(t){if(Array.isArray(t))return super(...t);return super(...he(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(t){this[0]=t}set g(t){this[1]=t}set b(t){this[2]=t}set(t){if(Array.isArray(t))return this.copy(t);return this.copy(he(...arguments))}copy(t){this[0]=t[0];this[1]=t[1];this[2]=t[2];return this}}class le extends R{constructor(t,{attributes:e={}}={}){Object.assign(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}});super(t,e)}}const ae=":host{display:block;width:100%;height:100%}canvas{width:100% !important;height:100% !important}";const ue=`#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n`;const ce=`#version 300 es\nprecision highp float;\n\nuniform float uTime;\nuniform float uAmplitude;\nuniform vec3 uColorStops[3];\nuniform vec2 uResolution;\nuniform float uBlend;\n\nout vec4 fragColor;\n\nvec3 permute(vec3 x) {\n  return mod(((x * 34.0) + 1.0) * x, 289.0);\n}\n\nfloat snoise(vec2 v){\n  const vec4 C = vec4(\n      0.211324865405187, 0.366025403784439,\n      -0.577350269189626, 0.024390243902439\n  );\n  vec2 i  = floor(v + dot(v, C.yy));\n  vec2 x0 = v - i + dot(i, C.xx);\n  vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod(i, 289.0);\n\n  vec3 p = permute(\n      permute(i.y + vec3(0.0, i1.y, 1.0))\n    + i.x + vec3(0.0, i1.x, 1.0)\n  );\n\n  vec3 m = max(\n      0.5 - vec3(\n          dot(x0, x0),\n          dot(x12.xy, x12.xy),\n          dot(x12.zw, x12.zw)\n      ),\n      0.0\n  );\n  m = m * m;\n  m = m * m;\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nstruct ColorStop {\n  vec3 color;\n  float position;\n};\n\n#define COLOR_RAMP(colors, factor, finalColor) {                int index = 0;                                              for (int i = 0; i < 2; i++) {                                    ColorStop currentColor = colors[i];                         bool isInBetween = currentColor.position <= factor;         index = int(mix(float(index), float(i), float(isInBetween)));   }                                                           ColorStop currentColor = colors[index];                     ColorStop nextColor = colors[index + 1];                    float range = nextColor.position - currentColor.position;   float lerpFactor = (factor - currentColor.position) / range;   finalColor = mix(currentColor.color, nextColor.color, lerpFactor); }\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / uResolution;\n\n  ColorStop colors[3];\n  colors[0] = ColorStop(uColorStops[0], 0.0);\n  colors[1] = ColorStop(uColorStops[1], 0.5);\n  colors[2] = ColorStop(uColorStops[2], 1.0);\n\n  vec3 rampColor;\n  COLOR_RAMP(colors, uv.x, rampColor);\n\n  float height = snoise(vec2(uv.x * 2.0 + uTime * 0.1, uTime * 0.25)) * 0.5 * uAmplitude;\n  height = exp(height);\n  height = (uv.y * 2.0 - height + 0.2);\n  float intensity = 0.6 * height;\n\n  float midPoint = 0.20;\n  float auroraAlpha = smoothstep(midPoint - uBlend * 0.5, midPoint + uBlend * 0.5, intensity);\n\n  vec3 auroraColor = intensity * rampColor;\n\n  fragColor = vec4(auroraColor * auroraAlpha, auroraAlpha);\n}\n`;const fe=class{constructor(e){t(this,e)}animateId=0;renderer;program;mesh;get el(){return e(this)}colorStops=["#5227FF","#7cff67","#5227FF"];amplitude=1;blend=.5;speed=1;time;connectedCallback(){let t=this.el.shadowRoot.querySelector("canvas");if(!t){t=document.createElement("canvas");this.el.shadowRoot.appendChild(t)}this.renderer=new D({canvas:t,alpha:true,premultipliedAlpha:true,antialias:true,width:this.el.offsetWidth,height:this.el.offsetHeight});const{amplitude:e,blend:i,colorStops:s,renderer:n}=this;const{gl:r}=n;r.clearColor(0,0,0,0);r.enable(r.BLEND);r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);r.canvas.style.backgroundColor="transparent";const h=s.map((t=>{const e=new oe(t);return[e.r,e.g,e.b]}));this.program=new X(r,{vertex:ue,fragment:ce,uniforms:{uTime:{value:0},uAmplitude:{value:e},uColorStops:{value:h},uResolution:{value:[this.el.offsetWidth,this.el.offsetHeight]},uBlend:{value:i}}});const o=new le(r);if(o.attributes.uv){delete o.attributes.uv}this.mesh=new ie(r,{geometry:o,program:this.program});this.animateId=requestAnimationFrame(this.update);window.addEventListener("resize",this.resize);this.resize()}disconnectCallback(){cancelAnimationFrame(this.animateId);window.removeEventListener("resize",this.resize);const{renderer:t}=this;const{gl:e}=t||{};e.getExtension("WEBGL_lose_context")?.loseContext()}resize=()=>{if(!this.el)return;const t=this.el.offsetWidth;const e=this.el.offsetHeight;this.renderer.setSize(t,e);if(this.program){this.program.uniforms.uResolution.value=[t,e]}this.renderer.render({scene:this.mesh})};update=t=>{this.animateId=requestAnimationFrame(this.update);const{program:e,renderer:i,amplitude:s,blend:n,colorStops:r,time:h=t*.01,speed:o=1}=this;e.uniforms.uTime.value=h*o*.1;e.uniforms.uAmplitude.value=s;e.uniforms.uBlend.value=n;e.uniforms.uColorStops.value=r.map((t=>{const e=new oe(t);return[e.r,e.g,e.b]}));i.render({scene:this.mesh})};render(){return i(s,{key:"03d1ca57920d9c018a244fa02925f471aaf0dd8a"})}};fe.style=ae;export{r as prx_audio_quote,fe as prx_bg_aurora};
//# sourceMappingURL=p-8994bf17.entry.js.map